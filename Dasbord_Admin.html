<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D' Hotel | Admin Panel</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        /* Reset dan Variabel */
        :root {
            --primary-color: #1e3a8a;
            --secondary-color: #0ea5e9;
            --accent-color: #f59e0b;
            --text-light: #f8fafc;
            --text-dark: #0f172a;
            --background-light: #ffffff;
            --background-dark: #0f172a;
            --danger-color: #dc2626;
            --success-color: #16a34a;
            --warning-color: #ca8a04;
            --sidebar-width: 250px;
            --sidebar-width-mobile: 0px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f8fafc;
            display: flex;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Sidebar Styling */
        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--background-dark);
            color: var(--text-light);
            position: fixed;
            height: 100vh;
            padding: 1rem 0;
            transition: all 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 0 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
        }

        .sidebar-logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-light);
            text-decoration: none;
            display: flex;
            align-items: center;
        }

        .logo img {
            height: 60px;
            /* Reduced from 90px */
            margin-right: 5px;
            transition: height 0.3s ease;
        }

        .sidebar-logo span {
            color: var(--accent-color);
        }

        .sidebar-logo i {
            margin-right: 10px;
            font-size: 1.5rem;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-item {
            margin-bottom: 0.5rem;
            position: relative;
        }

        .sidebar-link {
            display: flex;
            align-items: center;
            padding: 0.8rem 1.5rem;
            color: var(--text-light);
            text-decoration: none;
            transition: all 0.3s ease;
            position: relative;
            white-space: nowrap;
        }

        .sidebar-link:hover,
        .sidebar-link.active {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--accent-color);
        }

        .sidebar-link i {
            margin-right: 10px;
            font-size: 1.1rem;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            transition: all 0.3s ease;
            width: calc(100% - var(--sidebar-width));
        }

        /* Top Navbar */
        .top-navbar {
            background-color: var(--background-light);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .page-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .user-profile {
            position: relative;
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--accent-color);
            color: var(--text-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .user-name {
            margin-left: 10px;
            font-weight: 500;
        }

        .dropdown-arrow {
            margin-left: 5px;
            transition: transform 0.3s ease;
        }

        .user-dropdown {
            position: absolute;
            top: 50px;
            right: 0;
            background-color: var(--background-light);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            width: 200px;
            display: none;
            z-index: 101;
            overflow: hidden;
        }

        .user-dropdown.active {
            display: block;
        }

        .user-profile.active .dropdown-arrow {
            transform: rotate(180deg);
        }

        .dropdown-item {
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            color: var(--text-dark);
            transition: background-color 0.3s ease;
        }

        .dropdown-item:hover {
            background-color: #f5f5f5;
        }

        .dropdown-item.logout {
            color: var(--danger-color);
            border-top: 1px solid #e5e7eb;
        }

        /* Content Area */
        .content-area {
            padding: 2rem;
        }

        /* Dashboard Cards */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .card {
            background-color: var(--background-light);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 1rem;
            color: #64748b;
            font-weight: 500;
        }

        .card-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .card-icon.primary {
            background-color: rgba(14, 165, 233, 0.1);
            color: var(--secondary-color);
        }

        .card-icon.success {
            background-color: rgba(22, 163, 74, 0.1);
            color: var(--success-color);
        }

        .card-icon.warning {
            background-color: rgba(202, 138, 4, 0.1);
            color: var(--warning-color);
        }

        .card-icon.danger {
            background-color: rgba(220, 38, 38, 0.1);
            color: var(--danger-color);
        }

        .card-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .card-footer {
            font-size: 0.9rem;
            color: #64748b;
        }

        /* Charts */
        .charts-row {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        @media (max-width: 992px) {
            .charts-row {
                grid-template-columns: 1fr;
            }
        }

        .chart-container {
            background-color: var(--background-light);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .chart-title {
            font-size: 1.2rem;
            margin-bottom: 1.5rem;
            color: var(--text-dark);
        }

        /* Tables */
        .table-container {
            background-color: var(--background-light);
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin-bottom: 2rem;
        }

        .table-header {
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e5e7eb;
        }

        .table-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .table-actions {
            display: flex;
            gap: 1rem;
        }

        .table-btn {
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            border: none;
        }

        .table-btn.primary {
            background-color: var(--primary-color);
            color: var(--text-light);
        }

        .table-btn.primary:hover {
            background-color: #1a3a8a;
        }

        .table-btn.secondary {
            background-color: transparent;
            color: var(--text-dark);
            border: 1px solid #d1d5db;
        }

        .table-btn.secondary:hover {
            background-color: #f3f4f6;
        }

        .table-responsive {
            overflow-x: auto;
            width: 100%;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            min-width: 650px;
            /* Ensure minimum width for readability */
        }

        .table th {
            background-color: #f8fafc;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: #64748b;
            border-bottom: 1px solid #e5e7eb;
            position: sticky;
            top: 0;
        }

        .table td {
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
            color: var(--text-dark);
        }

        .table tr:last-child td {
            border-bottom: none;
        }

        .table tr:hover td {
            background-color: #f8fafc;
        }

        .status-badge {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            display: inline-block;
        }

        .status-pending {
            background-color: #fef3c7;
            color: var(--warning-color);
        }

        .status-confirmed {
            background-color: #dcfce7;
            color: var(--success-color);
        }

        .status-cancelled {
            background-color: #fee2e2;
            color: var(--danger-color);
        }

        .status-paid {
            background-color: #dbeafe;
            color: #2563eb;
        }

        .action-btn {
            padding: 0.3rem 0.6rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            margin: 0.2rem;
        }

        .action-btn.view {
            background-color: #e0f2fe;
            color: #0369a1;
        }

        .action-btn.view:hover {
            background-color: #bae6fd;
        }

        .action-btn.edit {
            background-color: #fef3c7;
            color: #b45309;
        }

        .action-btn.edit:hover {
            background-color: #fde68a;
        }

        .action-btn.delete {
            background-color: #fee2e2;
            color: #b91c1c;
        }

        .action-btn.delete:hover {
            background-color: #fecaca;
        }

        .action-btn.confirm {
            background-color: #dcfce7;
            color: #15803d;
        }

        .action-btn.confirm:hover {
            background-color: #bbf7d0;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            border-top: 1px solid #e5e7eb;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .pagination-info {
            font-size: 0.9rem;
            color: #64748b;
        }

        .pagination-controls {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .pagination-btn {
            padding: 0.5rem 1rem;
            border-radius: 4px;
            background-color: transparent;
            border: 1px solid #d1d5db;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .pagination-btn:hover {
            background-color: #f3f4f6;
        }

        .pagination-btn.active {
            background-color: var(--primary-color);
            color: var(--text-light);
            border-color: var(--primary-color);
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal.active {
            display: flex;
            opacity: 1;
        }

        .modal-content {
            background-color: var(--background-light);
            border-radius: 8px;
            padding: 2rem;
            width: 100%;
            max-width: 800px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(-20px);
            transition: transform 0.3s ease;
            margin: 0 1rem;
        }

        .modal.active .modal-content {
            transform: translateY(0);
        }

        .close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-dark);
            transition: color 0.3s ease;
        }

        .close-btn:hover {
            color: var(--danger-color);
        }

        .modal-title {
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            color: var(--primary-color);
            text-align: center;
        }

        .modal-text {
            text-align: center;
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .modal-actions {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        .modal-btn {
            padding: 0.8rem 1.5rem;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
            min-width: 120px;
        }

        .modal-btn-primary {
            background-color: var(--primary-color);
            color: var(--text-light);
            border: none;
        }

        .modal-btn-primary:hover {
            background-color: var(--secondary-color);
        }

        .modal-btn-danger {
            background-color: var(--danger-color);
            color: var(--text-light);
            border: none;
        }

        .modal-btn-danger:hover {
            background-color: #b91c1c;
        }

        .modal-btn-secondary {
            background-color: transparent;
            color: var(--text-dark);
            border: 1px solid #d1d5db;
        }

        .modal-btn-secondary:hover {
            background-color: #f3f4f6;
        }

        /* Reservation Details */
        .reservation-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        @media (max-width: 768px) {
            .reservation-details {
                grid-template-columns: 1fr;
            }
        }

        .detail-group {
            margin-bottom: 1.5rem;
        }

        .detail-label {
            font-size: 0.9rem;
            color: #64748b;
            margin-bottom: 0.5rem;
            display: block;
        }

        .detail-value {
            font-size: 1.1rem;
            font-weight: 500;
            color: var(--text-dark);
        }

        /* Report Modal */
        .report-form {
            margin-top: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-dark);
        }

        .form-input {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--secondary-color);
        }

        .form-row {
            display: flex;
            gap: 1rem;
        }

        .form-row .form-group {
            flex: 1;
        }

        /* Print Button */
        .print-btn {
            background-color: var(--accent-color);
            color: var(--text-light);
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1.5rem;
        }

        .print-btn:hover {
            background-color: #e67e22;
        }

        /* Hamburger Menu */
        .hamburger {
            display: none;
            cursor: pointer;
            font-size: 1.5rem;
            color: var(--text-dark);
            margin-right: 1rem;
            z-index: 1001;
        }

        /* Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, .3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .message-details {
            background-color: #f8fafc;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }

        .message-content {
            background-color: white;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            margin-top: 0.5rem;
            white-space: pre-wrap;
            font-size: 1rem;
            line-height: 1.6;
        }

        .reply-form {
            margin: 1.5rem 0;
        }

        .reply-form h3 {
            margin-bottom: 1rem;
            font-size: 1.2rem;
            color: var(--text-dark);
        }

        /* Status badges for messages */
        .status-unread {
            background-color: #fee2e2;
            color: var(--danger-color);
        }

        .status-read {
            background-color: #dcfce7;
            color: var(--success-color);
        }

        .status-replied {
            background-color: #dbeafe;
            color: #2563eb;
        }

        /* Badge for unread messages */
        .unread-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--danger-color);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .unread-badge.visible {
            display: flex;
        }

        /* Payment proof styling */
        .payment-proof-container {
            margin-top: 1rem;
            text-align: center;
        }

        .payment-proof-image {
            max-width: 100%;
            max-height: 350px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .payment-proof-image:hover {
            transform: scale(1.02);
        }

        #downloadProofBtn {
            background-color: #3b82f6;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-top: 1rem;
        }

        #downloadProofBtn:hover {
            background-color: #2563eb;
        }

        /* Form validation */
        .error-message {
            color: var(--danger-color);
            font-size: 0.8rem;
            margin-top: 0.5rem;
            display: none;
        }

        .form-group.error .form-input {
            border-color: var(--danger-color);
        }

        .form-group.error .error-message {
            display: block;
        }

        /* Animation classes */
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        /* Backdrop for mobile sidebar */
        .sidebar-backdrop {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        .sidebar-backdrop.active {
            display: block;
        }

        /* Improved Responsive design */
        @media (max-width: 992px) {
            .dashboard-cards {
                grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            }

            .content-area {
                padding: 1.5rem;
            }

            .logo img {
                height: 50px;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 0;
                transform: translateX(-100%);
            }

            .sidebar.active {
                width: 250px;
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                width: 100%;
            }

            .hamburger {
                display: block;
            }

            .table-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .table-actions {
                width: 100%;
                justify-content: flex-end;
                flex-wrap: wrap;
            }

            .top-navbar {
                padding: 0.8rem 1.5rem;
            }

            .page-title {
                font-size: 1.3rem;
            }

            .user-name {
                display: none;
            }

            .content-area {
                padding: 1.2rem;
            }

            .card {
                padding: 1.2rem;
            }

            .card-value {
                font-size: 1.5rem;
            }

            .modal-content {
                padding: 1.5rem;
            }

            .modal-title {
                font-size: 1.5rem;
            }

            .form-row {
                flex-direction: column;
                gap: 0;
            }

            .logo img {
                height: 45px;
            }

            .sidebar-header {
                padding: 0 1rem;
                margin-bottom: 1.5rem;
            }
        }

        @media (max-width: 576px) {
            .dashboard-cards {
                grid-template-columns: 1fr;
            }

            .card-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }

            .pagination {
                flex-direction: column;
                align-items: center;
            }

            .top-navbar {
                padding: 0.6rem 1rem;
            }

            .content-area {
                padding: 1rem;
            }

            .modal-content {
                padding: 1.2rem;
                margin: 0 0.8rem;
            }

            .modal-title {
                font-size: 1.3rem;
            }

            .chart-container {
                padding: 1rem;
            }

            .chart-title {
                font-size: 1.1rem;
            }

            .table-container {
                margin-bottom: 1.5rem;
            }

            .logo img {
                height: 40px;
            }

            .action-btn {
                padding: 0.25rem 0.5rem;
                font-size: 0.75rem;
            }

            .table th,
            .table td {
                padding: 0.8rem 0.6rem;
            }
        }

        @media (max-width: 375px) {
            .logo img {
                height: 35px;
            }

            .hamburger {
                font-size: 1.3rem;
                margin-right: 0.5rem;
            }

            .user-avatar {
                width: 35px;
                height: 35px;
            }

            .top-navbar {
                padding: 0.5rem 0.8rem;
            }

            .content-area {
                padding: 0.8rem;
            }

            .table-btn {
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
            }

            .modal-btn {
                padding: 0.7rem 1rem;
                font-size: 0.9rem;
            }

            .card {
                padding: 1rem;
            }
        }
    </style>
</head>

<body>
    <aside class="sidebar" id="sidebar">
        <a href="#" class="logo">
            <img src="1-removebg-preview.png" alt="D'Hotel Logo">
        </a>
        <ul class="sidebar-menu">
            <li class="sidebar-item">
                <a href="#dashboard" class="sidebar-link active" data-section="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a href="#reservations" class="sidebar-link" data-section="reservations">
                    <i class="fas fa-calendar-check"></i>
                    <span>Reservasi</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a href="#messages" class="sidebar-link" data-section="messages">
                    <i class="fas fa-envelope"></i>
                    <span>Pesan</span>
                    <span class="unread-badge" id="unreadBadge"></span>
                </a>
            </li>
            <li class="sidebar-item">
                <a href="#payments" class="sidebar-link" data-section="payments">
                    <i class="fas fa-credit-card"></i>
                    <span>Pembayaran</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a href="#reports" class="sidebar-link" data-section="reports">
                    <i class="fas fa-chart-bar"></i>
                    <span>Laporan</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a href="#rooms" class="sidebar-link" data-section="rooms">
                    <i class="fas fa-bed"></i>
                    <span>Kamar</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a href="#users" class="sidebar-link" data-section="users">
                    <i class="fas fa-users"></i>
                    <span>Pengguna</span>
                </a>
            </li>
        </ul>
    </aside>

    <div class="main-content">
        <nav class="top-navbar">
            <div class="hamburger" id="hamburger">
                <i class="fas fa-bars"></i>
            </div>
            <h1 class="page-title" id="pageTitle">Dashboard</h1>
            <div class="user-profile" id="userProfile">
                <div class="user-avatar" id="userAvatar">A</div>
                <span class="user-name" id="loggedUsername">Admin</span>
                <span class="dropdown-arrow">â–¼</span>
                <div class="user-dropdown" id="userDropdown">
                    <a href="#" class="dropdown-item">
                        <i class="fas fa-user"></i>
                        <span>Profil Saya</span>
                    </a>
                    <a id="logout" class="dropdown-item logout">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Logout</span>
                    </a>
                </div>
            </div>
        </nav>

        <div class="content-area">
            <section id="dashboard" class="content-section active">
                <div class="dashboard-cards">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Total Pendapatan Bulan Ini</h3>
                            <div class="card-icon primary">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                        </div>
                        <div class="card-value" id="monthlyRevenue">Rp 0</div>
                        <div class="card-footer">+0% dari bulan lalu</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Reservasi Bulan Ini</h3>
                            <div class="card-icon success">
                                <i class="fas fa-calendar-check"></i>
                            </div>
                        </div>
                        <div class="card-value" id="monthlyBookings">0</div>
                        <div class="card-footer">+0% dari bulan lalu</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Kamar Tersedia</h3>
                            <div class="card-icon warning">
                                <i class="fas fa-bed"></i>
                            </div>
                        </div>
                        <div class="card-value" id="availableRooms">0</div>
                        <div class="card-footer">Dari total 0 kamar</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Reservasi Pending</h3>
                            <div class="card-icon danger">
                                <i class="fas fa-exclamation-circle"></i>
                            </div>
                        </div>
                        <div class="card-value" id="pendingBookings">0</div>
                        <div class="card-footer">Perlu konfirmasi</div>
                    </div>
                </div>

                <div class="charts-row">
                    <div class="chart-container">
                        <h3 class="chart-title">Pendapatan 6 Bulan Terakhir</h3>
                        <canvas id="revenueChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3 class="chart-title">Status Reservasi</h3>
                        <canvas id="bookingStatusChart"></canvas>
                    </div>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Reservasi Terbaru</h3>
                        <div class="table-actions">
                            <button class="table-btn secondary">
                                <i class="fas fa-filter"></i> Filter
                            </button>
                            <button class="table-btn primary" id="refreshBookings">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table" id="recentBookingsTable">
                            <thead>
                                <tr>
                                    <th>ID Reservasi</th>
                                    <th>Nama Tamu</th>
                                    <th>Tipe Kamar</th>
                                    <th>Check-in</th>
                                    <th>Check-out</th>
                                    <th>Status</th>
                                    <th>Total</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                    <div class="pagination">
                        <div class="pagination-info">Menampilkan 0 dari 0 data</div>
                        <div class="pagination-controls">
                            <button class="pagination-btn" disabled>
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="pagination-btn active">1</button>
                            <button class="pagination-btn" disabled>
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <section id="reservations" class="content-section">
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Daftar Reservasi</h3>
                        <div class="table-actions">
                            <button class="table-btn secondary">
                                <i class="fas fa-filter"></i> Filter
                            </button>
                            <button class="table-btn primary" id="refreshAllBookings">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table" id="allBookingsTable">
                            <thead>
                                <tr>
                                    <th>ID Reservasi</th>
                                    <th>Nama Tamu</th>
                                    <th>Tipe Kamar</th>
                                    <th>Check-in</th>
                                    <th>Check-out</th>
                                    <th>Status</th>
                                    <th>Pembayaran</th>
                                    <th>Total</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                    <div class="pagination">
                        <div class="pagination-info">Menampilkan 0 dari 0 data</div>
                        <div class="pagination-controls">
                            <button class="pagination-btn" disabled>
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="pagination-btn active">1</button>
                            <button class="pagination-btn">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <section id="messages" class="content-section">
                <div class="dashboard-cards">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Pesan Baru</h3>
                            <div class="card-icon primary">
                                <i class="fas fa-envelope"></i>
                            </div>
                        </div>
                        <div class="card-value" id="newMessagesCount">0</div>
                        <div class="card-footer">Belum dibaca</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Total Pesan</h3>
                            <div class="card-icon success">
                                <i class="fas fa-comments"></i>
                            </div>
                        </div>
                        <div class="card-value" id="totalMessagesCount">0</div>
                        <div class="card-footer">Dari semua pelanggan</div>
                    </div>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Pesan Pelanggan</h3>
                        <div class="table-actions">
                            <button class="table-btn secondary" id="filterMessages">
                                <i class="fas fa-filter"></i> Filter
                            </button>
                            <button class="table-btn primary" id="refreshMessages">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table" id="messagesTable">
                            <thead>
                                <tr>
                                    <th width="15%">Tanggal</th>
                                    <th width="15%">Nama</th>
                                    <th width="15%">Email</th>
                                    <th width="20%">Subjek</th>
                                    <th width="15%">Status</th>
                                    <th width="20%">Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                    <div class="pagination">
                        <div class="pagination-info">Menampilkan 0 dari 0 data</div>
                        <div class="pagination-controls">
                            <button class="pagination-btn" disabled>
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="pagination-btn active">1</button>
                            <button class="pagination-btn" disabled>
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <section id="payments" class="content-section">
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Daftar Pembayaran</h3>
                        <div class="table-actions">
                            <button class="table-btn secondary">
                                <i class="fas fa-filter"></i> Filter
                            </button>
                            <button class="table-btn primary" id="refreshPayments">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table" id="paymentsTable">
                            <thead>
                                <tr>
                                    <th>ID Pembayaran</th>
                                    <th>ID Reservasi</th>
                                    <th>Nama Tamu</th>
                                    <th>Tanggal</th>
                                    <th>Metode</th>
                                    <th>Jumlah</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                    <div class="pagination">
                        <div class="pagination-info">Menampilkan 0 dari 0 data</div>
                        <div class="pagination-controls">
                            <button class="pagination-btn" disabled>
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="pagination-btn active">1</button>
                            <button class="pagination-btn">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <section id="reports" class="content-section">
                <div class="dashboard-cards">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Laporan Bulanan</h3>
                            <div class="card-icon primary">
                                <i class="fas fa-file-alt"></i>
                            </div>
                        </div>
                        <div class="card-value">Generate Laporan</div>
                        <div class="card-footer">Pilih periode untuk membuat laporan</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Laporan Tahunan</h3>
                            <div class="card-icon success">
                                <i class="fas fa-chart-line"></i>
                            </div>
                        </div>
                        <div class="card-value">Statistik Tahunan</div>
                        <div class="card-footer">Lihat tren tahunan</div>
                    </div>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Generate Laporan</h3>
                        <div class="table-actions">
                            <button class="table-btn primary" id="generateReport">
                                <i class="fas fa-file-export"></i> Generate
                            </button>
                            <button class="table-btn primary" id="printReport" disabled>
                                <i class="fas fa-print"></i> Cetak
                            </button>
                        </div>
                    </div>
                    <div class="report-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Jenis Laporan</label>
                                <select id="reportType" class="form-input">
                                    <option value="monthly">Laporan Bulanan</option>
                                    <option value="annual">Laporan Tahunan</option>
                                    <option value="custom">Periode Kustom</option>
                                </select>
                            </div>
                            <div class="form-group" id="monthYearGroup">
                                <label class="form-label">Bulan dan Tahun</label>
                                <input type="month" id="reportMonth" class="form-input">
                            </div>
                            <div class="form-group" id="yearGroup" style="display: none;">
                                <label class="form-label">Tahun</label>
                                <select id="reportYear" class="form-input">
                                    <option value="2023">2023</option>
                                    <option value="2024" selected>2024</option>
                                    <option value="2025">2025</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row" id="customDateGroup" style="display: none;">
                            <div class="form-group">
                                <label class="form-label">Dari Tanggal</label>
                                <input type="date" id="reportStartDate" class="form-input">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Sampai Tanggal</label>
                                <input type="date" id="reportEndDate" class="form-input">
                            </div>
                        </div>
                    </div>

                    <div id="reportResults" style="display: none;">
                        <h3 style="margin: 2rem 0 1rem;">Hasil Laporan</h3>
                        <div class="table-responsive">
                            <table class="table" id="reportTable">
                                <thead>
                                    <tr>
                                        <th>ID Reservasi</th>
                                        <th>Nama Tamu</th>
                                        <th>Tipe Kamar</th>
                                        <th>Check-in</th>
                                        <th>Check-out</th>
                                        <th>Status</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                        <div class="pagination">
                            <div class="pagination-info">Total Pendapatan: <strong id="reportTotal">Rp 0</strong></div>
                            <div class="pagination-info">Jumlah Reservasi: <strong id="reportCount">0</strong></div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="rooms" class="content-section">
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Daftar Kamar</h3>
                        <div class="table-actions">
                            <button class="table-btn primary" id="addRoomBtn">
                                <i class="fas fa-plus"></i> Tambah Kamar
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table" id="roomsTable">
                            <thead>
                                <tr>
                                    <th>ID Kamar</th>
                                    <th>Tipe Kamar</th>
                                    <th>Harga/Malam</th>
                                    <th>Kapasitas</th>
                                    <th>Fasilitas</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                    <div class="pagination">
                        <div class="pagination-info">Menampilkan 0 dari 0 data</div>
                        <div class="pagination-controls">
                            <button class="pagination-btn" disabled>
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="pagination-btn active">1</button>
                            <button class="pagination-btn">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <section id="users" class="content-section">
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Daftar Pengguna</h3>
                        <div class="table-actions">
                            <button class="table-btn primary" id="addUserBtn">
                                <i class="fas fa-plus"></i> Tambah Pengguna
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table" id="usersTable">
                            <thead>
                                <tr>
                                    <th>ID Pengguna</th>
                                    <th>Nama</th>
                                    <th>Email</th>
                                    <th>Peran</th>
                                    <th>Tanggal Daftar</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                    <div class="pagination">
                        <div class="pagination-info">Menampilkan 0 dari 0 data</div>
                        <div class="pagination-controls">
                            <button class="pagination-btn" disabled>
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="pagination-btn active">1</button>
                            <button class="pagination-btn">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>


    <div class="modal" id="reservationModal">
        <div class="modal-content">
            <span class="close-btn" id="closeReservationModal">&times;</span>
            <h2 class="modal-title">Detail Reservasi</h2>

            <div class="reservation-details">
                <div>
                    <div class="detail-group">
                        <span class="detail-label">ID Reservasi</span>
                        <span class="detail-value" id="detailId">-</span>
                    </div>
                    <div class="detail-group">
                        <span class="detail-label">Nama Tamu</span>
                        <span class="detail-value" id="detailCustomerName">-</span>
                    </div>
                    <div class="detail-group">
                        <span class="detail-label">Email</span>
                        <span class="detail-value" id="detailCustomerEmail">-</span>
                    </div>
                    <div class="detail-group">
                        <span class="detail-label">Nomor Telepon</span>
                        <span class="detail-value" id="detailCustomerPhone">-</span>
                    </div>
                    <div class="detail-group">
                        <span class="detail-label">Keterangan</span>
                        <span class="detail-value" id="detailNotes">-</span>
                    </div>
                </div>
                <div>
                    <div class="detail-group">
                        <span class="detail-label">Tipe Kamar</span>
                        <span class="detail-value" id="detailRoomType">-</span>
                    </div>
                    <div class="detail-group">
                        <span class="detail-label">Check-in</span>
                        <span class="detail-value" id="detailCheckIn">-</span>
                    </div>
                    <div class="detail-group">
                        <span class="detail-label">Check-out</span>
                        <span class="detail-value" id="detailCheckOut">-</span>
                    </div>
                    <div class="detail-group">
                        <span class="detail-label">Jumlah Tamu</span>
                        <span class="detail-value" id="detailGuests">-</span>
                    </div>
                    <div class="detail-group">
                        <span class="detail-label">Status</span>
                        <span class="detail-value" id="detailStatus">-</span>
                    </div>
                    <div class="detail-group" id="paymentProofContainer" style="display: none;">
                        <span class="detail-label">Bukti Pembayaran</span>
                        <div class="payment-proof-container">
                            <img id="paymentProofImage" src="" class="payment-proof-image" alt="Bukti Pembayaran">
                            <button id="downloadProofBtn" class="action-btn view">
                                <i class="fas fa-download"></i> Unduh Bukti
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="detail-group">
                <span class="detail-label">Detail Pembayaran</span>
                <div style="background-color: #f8fafc; padding: 1rem; border-radius: 8px; margin-top: 0.5rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span>Harga Kamar:</span>
                        <span id="detailRoomPrice">Rp 0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span>Jumlah Malam:</span>
                        <span id="detailNights">0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span>Pajak & Layanan:</span>
                        <span id="detailTax">Rp 0</span>
                    </div>
                    <div
                        style="display: flex; justify-content: space-between; font-weight: 600; font-size: 1.1rem; padding-top: 0.5rem; border-top: 1px solid #e5e7eb; margin-top: 0.5rem;">
                        <span>Total:</span>
                        <span id="detailTotal">Rp 0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-top: 0.5rem;">
                        <span>Status Pembayaran:</span>
                        <span id="detailPaymentStatus">-</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-top: 0.5rem;">
                        <span>Metode Pembayaran:</span>
                        <span id="detailPaymentMethod">-</span>
                    </div>
                </div>
            </div>

            <div class="modal-actions">
                <button class="modal-btn modal-btn-secondary" id="closeDetailModal">Tutup</button>
                <button class="modal-btn modal-btn-primary" id="confirmReservation"
                    style="display: none;">Konfirmasi</button>
                <button class="modal-btn modal-btn-danger" id="cancelReservation"
                    style="display: none;">Batalkan</button>
                <button class="modal-btn" id="printReservation"
                    style="background-color: var(--accent-color); color: white;">
                    <i class="fas fa-print"></i> Cetak
                </button>
            </div>
        </div>
    </div>

    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <span class="close-btn" id="closeConfirmModal">&times;</span>
            <h2 class="modal-title">Konfirmasi Reservasi</h2>
            <p class="modal-text">Apakah Anda yakin ingin mengkonfirmasi reservasi ini? Tamu akan menerima notifikasi
                konfirmasi.</p>
            <div class="modal-actions">
                <button class="modal-btn modal-btn-secondary" id="cancelConfirm">Batal</button>
                <button class="modal-btn modal-btn-primary" id="confirmReservationBtn">Konfirmasi</button>
            </div>
        </div>
    </div>

    <div class="modal" id="adminCancelModal">
        <div class="modal-content">
            <span class="close-btn" id="closeAdminCancelModal">&times;</span>
            <h2 class="modal-title">Batalkan Reservasi</h2>
            <p class="modal-text">Apakah Anda yakin ingin membatalkan reservasi ini? Tamu akan menerima notifikasi
                pembatalan.</p>
            <div class="form-group" style="margin-top: 1.5rem;">
                <label class="form-label">Alasan Pembatalan (Opsional)</label>
                <textarea id="cancelReason" class="form-input" rows="3"
                    placeholder="Masukkan alasan pembatalan"></textarea>
            </div>
            <div class="modal-actions" style="margin-top: 1.5rem;">
                <button class="modal-btn modal-btn-secondary" id="cancelAdminCancel">Batal</button>
                <button class="modal-btn modal-btn-danger" id="confirmCancelBtn">Batalkan Reservasi</button>
            </div>
        </div>
    </div>

    <div class="modal" id="roomModal">
        <div class="modal-content">
            <span class="close-btn" id="closeRoomModal">&times;</span>
            <h2 class="modal-title" id="roomModalTitle">Tambah Kamar Baru</h2>

            <form id="roomForm">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Tipe Kamar</label>
                        <input type="text" id="roomType" class="form-input" required>
                        <div class="error-message">Tipe kamar harus diisi</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Harga per Malam</label>
                        <input type="number" id="roomPrice" class="form-input" required min="0">
                        <div class="error-message">Harga harus diisi</div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Kapasitas</label>
                        <input type="number" id="roomCapacity" class="form-input" required min="1">
                        <div class="error-message">Kapasitas harus diisi</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Jumlah Kamar Tersedia</label>
                        <input type="number" id="roomQuantity" class="form-input" required min="0">
                        <div class="error-message">Jumlah kamar harus diisi</div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Fasilitas</label>
                    <textarea id="roomAmenities" class="form-input" rows="3" required></textarea>
                    <div class="error-message">Fasilitas harus diisi</div>
                </div>

                <div class="form-group">
                    <label class="form-label">Deskripsi</label>
                    <textarea id="roomDescription" class="form-input" rows="3" required></textarea>
                    <div class="error-message">Deskripsi harus diisi</div>
                </div>

                <div class="form-group">
                    <label class="form-label">Gambar Kamar (URL)</label>
                    <input type="text" id="roomImage" class="form-input" required>
                    <div class="error-message">URL gambar harus diisi</div>
                </div>

                <div class="form-actions" style="margin-top: 1.5rem;">
                    <button type="button" class="modal-btn modal-btn-secondary" id="cancelRoomBtn">Batal</button>
                    <button type="submit" class="modal-btn modal-btn-primary">Simpan</button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal" id="userModal">
        <div class="modal-content">
            <span class="close-btn" id="closeUserModal">&times;</span>
            <h2 class="modal-title" id="userModalTitle">Tambah Pengguna Baru</h2>

            <form id="userForm">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Nama Lengkap</label>
                        <input type="text" id="userName" class="form-input" required>
                        <div class="error-message">Nama harus diisi</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" id="userEmail" class="form-input" required>
                        <div class="error-message">Email harus valid</div>
                    </div>
                </div>

                <div class="form-row" id="passwordFields">
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" id="userPassword" class="form-input" required minlength="6">
                        <div class="error-message">Password minimal 6 karakter</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Konfirmasi Password</label>
                        <input type="password" id="userConfirmPassword" class="form-input" required>
                        <div class="error-message">Password tidak cocok</div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Peran</label>
                        <select id="userRole" class="form-input" required>
                            <option value="admin">Admin</option>
                            <option value="staff">Staff</option>
                            <option value="guest" selected>Tamu</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <select id="userStatus" class="form-input" required>
                            <option value="active" selected>Aktif</option>
                            <option value="inactive">Nonaktif</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Nomor Telepon</label>
                    <input type="text" id="userPhone" class="form-input">
                </div>

                <div class="form-actions" style="margin-top: 1.5rem;">
                    <button type="button" class="modal-btn modal-btn-secondary" id="cancelUserBtn">Batal</button>
                    <button type="submit" class="modal-btn modal-btn-primary">Simpan</button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal" id="messageModal">
        <div class="modal-content">
            <span class="close-btn" id="closeMessageModal">&times;</span>
            <h2 class="modal-title">Detail Pesan</h2>

            <div class="message-details">
                <div class="detail-group">
                    <span class="detail-label">Dari</span>
                    <span class="detail-value" id="messageFrom">-</span>
                </div>
                <div class="detail-group">
                    <span class="detail-label">Email</span>
                    <span class="detail-value" id="messageEmail">-</span>
                </div>
                <div class="detail-group">
                    <span class="detail-label">Tanggal</span>
                    <span class="detail-value" id="messageDate">-</span>
                </div>
                <div class="detail-group">
                    <span class="detail-label">Subjek</span>
                    <span class="detail-value" id="messageSubject">-</span>
                </div>
                <div class="detail-group">
                    <span class="detail-label">Pesan</span>
                    <div class="message-content" id="messageContent">-</div>
                </div>
            </div>

            <div class="reply-form" id="replyForm">
                <h3>Balas Pesan</h3>
                <div class="form-group">
                    <textarea id="replyMessage" class="form-input" rows="5" placeholder="Tulis balasan Anda di sini..."
                        required></textarea>
                    <div class="error-message">Pesan balasan harus diisi</div>
                </div>
                <div class="modal-actions">
                    <button class="modal-btn modal-btn-primary" id="sendReply">
                        <i class="fas fa-paper-plane"></i> Kirim Balasan
                    </button>
                </div>
            </div>

            <div class="modal-actions">
                <button class="modal-btn modal-btn-secondary" id="closeMessageDetailModal">Tutup</button>
                <button class="modal-btn modal-btn-danger" id="markAsRead" style="display: none;">Tandai Sudah
                    Dibaca</button>
            </div>
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyArmh_5c2TI37fR9UiKv8Zt_Toy-UNTwzk",
            authDomain: "website-hotel-d0944.firebaseapp.com",
            databaseURL: "https://website-hotel-d0944-default-rtdb.firebaseio.com",
            projectId: "website-hotel-d0944",
            storageBucket: "website-hotel-d0944.appspot.com",
            messagingSenderId: "1092884245966",
            appId: "1:1092884245966:web:ca723170ff5fcf9a6f8f9f",
            measurementId: "G-S3LCNK9LX5"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const realtimeDb = firebase.database();

        // Initialize variables
        let currentUser = null;
        let currentReservation = null;
        let currentRoom = null;
        let currentEditUser = null;
        let currentCustomerMessage = null;
        let revenueChart = null;
        let bookingStatusChart = null;

        // Room types and their quantities
        const roomTypes = {
            'Executive': { total: 2, booked: [] },
            'Deluxe': { total: 1, booked: [] },
            'Suite': { total: 1, booked: [] }
        };

        function isRoomAvailable(roomType, checkInDate, checkOutDate) {
            if (!roomTypes[roomType]) return false;

            const checkIn = new Date(checkInDate);
            const checkOut = new Date(checkOutDate);

            // Hitung kamar yang sudah dipesan untuk rentang tanggal tersebut
            let bookedCount = 0;
            for (const booking of roomTypes[roomType].booked) {
                const bookedCheckIn = new Date(booking.checkIn);
                const bookedCheckOut = new Date(booking.checkOut);

                // Cek apakah ada overlap tanggal
                if (checkIn < bookedCheckOut && checkOut > bookedCheckIn) {
                    bookedCount++;
                }
            }

            // Periksa apakah masih ada kamar tersedia
            return bookedCount < roomTypes[roomType].total;
        }

        // Fungsi untuk memesan kamar
        function bookRoom(roomType, checkInDate, checkOutDate, bookingId) {
            if (!isRoomAvailable(roomType, checkInDate, checkOutDate)) {
                return false;
            }

            // Tambahkan ke daftar kamar yang dipesan
            roomTypes[roomType].booked.push({
                bookingId,
                checkIn: checkInDate,
                checkOut: checkOutDate
            });

            return true;
        }

        // Fungsi untuk membatalkan pemesanan kamar
        function releaseRoom(roomType, bookingId) {
            if (!roomTypes[roomType]) return false;

            // Hapus dari daftar kamar yang dipesan
            roomTypes[roomType].booked = roomTypes[roomType].booked.filter(
                booking => booking.bookingId !== bookingId
            );

            return true;
        }

        // Function to check and release rooms past their check-out date
        function updateRoomAvailability() {
            const now = new Date();

            for (const roomType in roomTypes) {
                const toRelease = [];

                // Find bookings that have completed
                roomTypes[roomType].booked.forEach(booking => {
                    const checkOutDate = new Date(booking.checkOut);
                    if (checkOutDate < now) {
                        toRelease.push(booking.bookingId);
                    }
                });

                // Release those rooms
                toRelease.forEach(bookingId => {
                    releaseRoom(roomType, bookingId);
                });
            }

            // Update UI
            countAvailableRooms();
        }

        document.addEventListener('DOMContentLoaded', function () {
            // DOM elements
            const sidebar = document.getElementById('sidebar');
            const hamburger = document.getElementById('hamburger');
            const userProfile = document.getElementById('userProfile');
            const userDropdown = document.getElementById('userDropdown');
            const logoutBtn = document.getElementById('logout');
            const userAvatar = document.getElementById('userAvatar');
            const loggedUsername = document.getElementById('loggedUsername');
            const pageTitle = document.getElementById('pageTitle');
            const contentSections = document.querySelectorAll('.content-section');
            const sidebarLinks = document.querySelectorAll('.sidebar-link');

            // Modal elements
            const reservationModal = document.getElementById('reservationModal');
            const closeReservationModal = document.getElementById('closeReservationModal');
            const closeDetailModal = document.getElementById('closeDetailModal');
            const confirmReservation = document.getElementById('confirmReservation');
            const cancelReservation = document.getElementById('cancelReservation');
            const printReservation = document.getElementById('printReservation');

            const confirmModal = document.getElementById('confirmModal');
            const closeConfirmModal = document.getElementById('closeConfirmModal');
            const cancelConfirm = document.getElementById('cancelConfirm');
            const confirmReservationBtn = document.getElementById('confirmReservationBtn');

            const adminCancelModal = document.getElementById('adminCancelModal');
            const closeAdminCancelModal = document.getElementById('closeAdminCancelModal');
            const cancelAdminCancel = document.getElementById('cancelAdminCancel');
            const confirmCancelBtn = document.getElementById('confirmCancelBtn');

            const roomModal = document.getElementById('roomModal');
            const closeRoomModal = document.getElementById('closeRoomModal');
            const cancelRoomBtn = document.getElementById('cancelRoomBtn');
            const roomForm = document.getElementById('roomForm');
            const roomModalTitle = document.getElementById('roomModalTitle');
            const addRoomBtn = document.getElementById('addRoomBtn');

            const userModal = document.getElementById('userModal');
            const closeUserModal = document.getElementById('closeUserModal');
            const cancelUserBtn = document.getElementById('cancelUserBtn');
            const userForm = document.getElementById('userForm');
            const userModalTitle = document.getElementById('userModalTitle');
            const addUserBtn = document.getElementById('addUserBtn');
            const passwordFields = document.getElementById('passwordFields');

            // Buttons
            const refreshBookings = document.getElementById('refreshBookings');
            const refreshAllBookings = document.getElementById('refreshAllBookings');
            const refreshPayments = document.getElementById('refreshPayments');
            const generateReport = document.getElementById('generateReport');
            const printReport = document.getElementById('printReport');
            const refreshMessages = document.getElementById('refreshMessages');
            const sendReply = document.getElementById('sendReply');
            const markAsRead = document.getElementById('markAsRead');

            // Report elements
            const reportType = document.getElementById('reportType');
            const monthYearGroup = document.getElementById('monthYearGroup');
            const yearGroup = document.getElementById('yearGroup');
            const customDateGroup = document.getElementById('customDateGroup');
            const reportResults = document.getElementById('reportResults');

            // Check auth state
            auth.onAuthStateChanged((user) => {
                if (user) {
                    currentUser = user;
                    userAvatar.textContent = user.email.charAt(0).toUpperCase();
                    loggedUsername.textContent = 'Admin';

                    // Check if user is admin
                    checkAdminStatus(user.uid);

                    // Load data
                    loadDashboardData();
                    loadRecentBookings();
                    loadAllBookings();
                    loadPayments();
                    loadRooms();
                    loadUsers();
                    loadMessages();
                    initCharts();
                    setupMessagesListener();

                    // Initialize room availability and start periodic checks
                    updateRoomAvailability();
                    setInterval(updateRoomAvailability, 3600000); // Check every hour
                } else {
                    window.location.href = 'admin.html';
                }
            });

            // Sidebar toggle
            hamburger.addEventListener('click', function () {
                sidebar.classList.toggle('active');
            });

            // User dropdown toggle
            userProfile.addEventListener('click', function (e) {
                e.stopPropagation();
                userProfile.classList.toggle('active');
                userDropdown.classList.toggle('active');
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', function (e) {
                if (!userProfile.contains(e.target)) {
                    userProfile.classList.remove('active');
                    userDropdown.classList.remove('active');
                }
            });

            // Sidebar navigation
            sidebarLinks.forEach(link => {
                link.addEventListener('click', function (e) {
                    e.preventDefault();

                    // Remove active class from all links
                    sidebarLinks.forEach(l => l.classList.remove('active'));

                    // Add active class to clicked link
                    this.classList.add('active');

                    // Get section id
                    const sectionId = this.getAttribute('href').substring(1);

                    // Update page title
                    pageTitle.textContent = this.querySelector('span').textContent;

                    // Hide all sections
                    contentSections.forEach(section => {
                        section.classList.remove('active');
                    });

                    // Show selected section
                    document.getElementById(sectionId).classList.add('active');

                    // Scroll to top
                    window.scrollTo(0, 0);
                });
            });

            // Logout function
            logoutBtn.addEventListener('click', function (e) {
                e.preventDefault();

                Swal.fire({
                    title: 'Keluar dari sistem?',
                    text: "Anda akan keluar dari panel admin",
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Ya, Keluar',
                    cancelButtonText: 'Batal',
                    showClass: {
                        popup: 'animate__animated animate__fadeInDown'
                    },
                    hideClass: {
                        popup: 'animate__animated animate__fadeOutUp'
                    }
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Animasi loading saat proses logout
                        Swal.fire({
                            title: 'Sedang keluar...',
                            html: 'Harap tunggu sebentar',
                            timer: 2000,
                            timerProgressBar: true,
                            didOpen: () => {
                                Swal.showLoading()
                                const b = Swal.getHtmlContainer().querySelector('b')
                                timerInterval = setInterval(() => {
                                    b.textContent = Swal.getTimerLeft()
                                }, 100)
                            },
                        }).then(() => {
                            // Proses logout setelah animasi selesai
                            auth.signOut().then(() => {
                                // Animasi sukses logout
                                Swal.fire({
                                    position: 'center',
                                    icon: 'success',
                                    title: 'Anda telah keluar',
                                    showConfirmButton: false,
                                    timer: 1500,
                                    background: '#1e293b',
                                    color: '#f8fafc',
                                    showClass: {
                                        popup: 'animate__animated animate__zoomIn'
                                    },
                                    hideClass: {
                                        popup: 'animate__animated animate__zoomOut'
                                    }
                                }).then(() => {
                                    window.location.href = 'admin.html';
                                });
                            });
                        });
                    }
                });
            });

            // Check if user is admin
            function checkAdminStatus(userId) {
                db.collection('users').doc(userId).get()
                    .then(doc => {
                        if (doc.exists) {
                            const userData = doc.data();
                            if (userData.role !== 'admin') {
                                // Redirect non-admin users
                                showAlert('Anda tidak memiliki akses ke halaman ini', 'error');
                                setTimeout(() => {
                                    window.location.href = 'pelanggan.html';
                                }, 2000);
                            }
                        }
                    })
                    .catch(error => {
                        console.error('Error checking admin status:', error);
                    });
            }

            // Load dashboard data
            function loadDashboardData() {
                // Calculate monthly revenue
                calculateMonthlyRevenue();

                // Count monthly bookings
                countMonthlyBookings();

                // Count available rooms
                countAvailableRooms();

                // Count pending bookings
                countPendingBookings();
            }

            // Calculate monthly revenue
            function calculateMonthlyRevenue() {
                const now = new Date();
                const firstDay = new Date(now.getFullYear(), now.getMonth(), 1).toISOString();
                const lastDay = new Date(now.getFullYear(), now.getMonth() + 1, 0).toISOString();

                realtimeDb.ref('bookings').orderByChild('paymentStatus').equalTo('paid').once('value')
                    .then(snapshot => {
                        let totalRevenue = 0;
                        snapshot.forEach(booking => {
                            const bookingData = booking.val();
                            const bookingDate = new Date(bookingData.paymentDate || bookingData.timestamp);

                            if (bookingDate >= new Date(firstDay)) {
                                const amount = bookingData.totalCost ?
                                    parseFloat(bookingData.totalCost.replace(/[^0-9]/g, '')) : 0;
                                totalRevenue += amount;
                            }
                        });

                        document.getElementById('monthlyRevenue').textContent =
                            `Rp ${totalRevenue.toLocaleString('id-ID')}`;
                    })
                    .catch(error => {
                        console.error('Error calculating revenue:', error);
                    });
            }

            // Count monthly bookings
            function countMonthlyBookings() {
                const now = new Date();
                const firstDay = new Date(now.getFullYear(), now.getMonth(), 1).toISOString();

                realtimeDb.ref('bookings').orderByChild('timestamp').startAt(firstDay).once('value')
                    .then(snapshot => {
                        const count = snapshot.numChildren();
                        document.getElementById('monthlyBookings').textContent = count;
                    })
                    .catch(error => {
                        console.error('Error counting bookings:', error);
                    });
            }

            // Count available rooms
            function countAvailableRooms() {
                // Initialize all rooms as available first
                for (const type in roomTypes) {
                    roomTypes[type].available = roomTypes[type].total;
                }

                // Check bookings to see which rooms are occupied
                realtimeDb.ref('bookings').orderByChild('status').equalTo('confirmed').once('value')
                    .then(snapshot => {
                        snapshot.forEach(booking => {
                            const bookingData = booking.val();
                            const roomType = bookingData.roomTitle;

                            if (roomType && roomTypes[roomType]) {
                                roomTypes[roomType].available = Math.max(0, roomTypes[roomType].available - 1);
                            }
                        });

                        // Calculate total available rooms
                        let totalAvailable = 0;
                        let totalRooms = 0;

                        for (const type in roomTypes) {
                            totalAvailable += roomTypes[type].available;
                            totalRooms += roomTypes[type].total;
                        }

                        // Update the UI
                        document.getElementById('availableRooms').textContent = totalAvailable;
                        document.getElementById('availableRooms').nextElementSibling.textContent =
                            `Dari total ${totalRooms} kamar (Deluxe: ${roomTypes['Deluxe'].available}, Executive: ${roomTypes['Executive'].available}, Suite: ${roomTypes['Suite'].available})`;
                    })
                    .catch(error => {
                        console.error('Error counting rooms:', error);
                    });
            }

            // Count pending bookings
            function countPendingBookings() {
                realtimeDb.ref('bookings').orderByChild('status').equalTo('pending').once('value')
                    .then(snapshot => {
                        const count = snapshot.numChildren();
                        document.getElementById('pendingBookings').textContent = count;
                    })
                    .catch(error => {
                        console.error('Error counting pending bookings:', error);
                    });
            }

            // Load recent bookings
            function loadRecentBookings() {
                const tbody = document.querySelector('#recentBookingsTable tbody');
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center;">Memuat data...</td></tr>';

                realtimeDb.ref('bookings').orderByChild('timestamp').limitToLast(5).once('value')
                    .then(snapshot => {
                        tbody.innerHTML = '';

                        if (!snapshot.exists()) {
                            tbody.innerHTML = '<tr><td colspan="8" style="text-align: center;">Tidak ada data reservasi</td></tr>';
                            return;
                        }

                        const bookings = [];
                        snapshot.forEach(booking => {
                            bookings.push({
                                id: booking.key,
                                ...booking.val()
                            });
                        });

                        // Sort by date (newest first)
                        bookings.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

                        bookings.forEach(booking => {
                            const row = createBookingRow(booking);
                            tbody.appendChild(row);
                        });
                    })
                    .catch(error => {
                        console.error('Error loading bookings:', error);
                        tbody.innerHTML = '<tr><td colspan="8" style="text-align: center;">Gagal memuat data</td></tr>';
                    });
            }

            // Load all bookings
            function loadAllBookings() {
                const tbody = document.querySelector('#allBookingsTable tbody');
                tbody.innerHTML = '<tr><td colspan="9" style="text-align: center;">Memuat data...</td></tr>';

                realtimeDb.ref('bookings').orderByChild('timestamp').once('value')
                    .then(snapshot => {
                        tbody.innerHTML = '';

                        if (!snapshot.exists()) {
                            tbody.innerHTML = '<tr><td colspan="9" style="text-align: center;">Tidak ada data reservasi</td></tr>';
                            return;
                        }

                        const bookings = [];
                        snapshot.forEach(booking => {
                            bookings.push({
                                id: booking.key,
                                ...booking.val()
                            });
                        });

                        // Sort by date (newest first)
                        bookings.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

                        bookings.forEach(booking => {
                            const row = createBookingRow(booking, true);
                            tbody.appendChild(row);
                        });
                    })
                    .catch(error => {
                        console.error('Error loading bookings:', error);
                        tbody.innerHTML = '<tr><td colspan="9" style="text-align: center;">Gagal memuat data</td></tr>';
                    });
            }

            // Load payments
            function loadPayments() {
                const tbody = document.querySelector('#paymentsTable tbody');
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center;">Memuat data...</td></tr>';

                realtimeDb.ref('payments').orderByChild('timestamp').once('value')
                    .then(snapshot => {
                        tbody.innerHTML = '';

                        if (!snapshot.exists()) {
                            tbody.innerHTML = '<tr><td colspan="8" style="text-align: center;">Tidak ada data pembayaran</td></tr>';
                            return;
                        }

                        const payments = [];
                        snapshot.forEach(payment => {
                            payments.push({
                                id: payment.key,
                                ...payment.val()
                            });
                        });

                        // Sort by date (newest first)
                        payments.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

                        payments.forEach(payment => {
                            const row = createPaymentRow(payment);
                            tbody.appendChild(row);
                        });
                    })
                    .catch(error => {
                        console.error('Error loading payments:', error);
                        tbody.innerHTML = '<tr><td colspan="8" style="text-align: center;">Gagal memuat data</td></tr>';
                    });
            }

            // Create payment row
            function createPaymentRow(payment) {
                const row = document.createElement('tr');

                // Format date
                let paymentDate = 'Invalid Date';
                try {
                    paymentDate = new Date(payment.timestamp).toLocaleDateString('id-ID');
                } catch (e) {
                    console.error('Error formatting date:', e);
                }

                // Status badge
                let statusBadge = '';
                if (payment.status === 'completed') {
                    statusBadge = '<span class="status-badge status-confirmed">Lunas</span>';
                } else if (payment.status === 'pending') {
                    statusBadge = '<span class="status-badge status-pending">Menunggu</span>';
                } else {
                    statusBadge = '<span class="status-badge status-cancelled">Gagal</span>';
                }

                row.innerHTML = `
                    <td>${payment.id.substring(0, 8)}</td>
                    <td>${payment.bookingId?.substring(0, 8) || '-'}</td>
                    <td>${payment.customerName || '-'}</td>
                    <td>${paymentDate}</td>
                    <td>${payment.method || '-'}</td>
                    <td>${payment.amount ? 'Rp ' + payment.amount.toLocaleString('id-ID') : 'Rp 0'}</td>
                    <td>${statusBadge}</td>
                    <td>
                        <button class="action-btn view" data-id="${payment.id}">
                            <i class="fas fa-eye"></i> Lihat
                        </button>
                    </td>
                `;

                // Add event listener to view button
                const viewBtn = row.querySelector('.action-btn.view');
                viewBtn.addEventListener('click', function () {
                    showPaymentDetails(payment);
                });

                return row;
            }

            // Show payment details
            function showPaymentDetails(payment) {
                // For now, just show an alert with payment details
                Swal.fire({
                    title: 'Detail Pembayaran',
                    html: `
                        <div style="text-align: left;">
                            <p><strong>ID Pembayaran:</strong> ${payment.id}</p>
                            <p><strong>ID Reservasi:</strong> ${payment.bookingId || '-'}</p>
                            <p><strong>Nama Tamu:</strong> ${payment.customerName || '-'}</p>
                            <p><strong>Tanggal:</strong> ${new Date(payment.timestamp).toLocaleDateString('id-ID')}</p>
                            <p><strong>Metode:</strong> ${payment.method || '-'}</p>
                            <p><strong>Jumlah:</strong> ${payment.amount ? 'Rp ' + payment.amount.toLocaleString('id-ID') : 'Rp 0'}</p>
                            <p><strong>Status:</strong> ${payment.status === 'completed' ? 'Lunas' : payment.status === 'pending' ? 'Menunggu' : 'Gagal'}</p>
                        </div>
                    `,
                    confirmButtonText: 'Tutup'
                });
            }

            // Create booking row
            function createBookingRow(booking, showActions = false) {
                const row = document.createElement('tr');

                // Format dates
                let checkInDate = 'Invalid Date';
                let checkOutDate = 'Invalid Date';
                try {
                    checkInDate = new Date(booking.startDate).toLocaleDateString('id-ID');
                    checkOutDate = new Date(booking.endDate).toLocaleDateString('id-ID');
                } catch (e) {
                    console.error('Error formatting dates:', e);
                }

                // Status badge
                let statusBadge = '';
                if (booking.status === 'cancelled') {
                    statusBadge = '<span class="status-badge status-cancelled">Dibatalkan</span>';
                } else if (booking.paymentStatus === 'paid') {
                    statusBadge = '<span class="status-badge status-confirmed">Terkonfirmasi</span>';
                } else if (booking.status === 'pending') {
                    statusBadge = '<span class="status-badge status-pending">Menunggu</span>';
                } else {
                    statusBadge = '<span class="status-badge status-pending">Pending</span>';
                }

                // Payment status
                let paymentStatus = '';
                if (booking.paymentStatus === 'paid') {
                    paymentStatus = '<span class="status-badge status-paid">Lunas</span>';
                } else {
                    paymentStatus = '<span class="status-badge status-pending">Belum</span>';
                }

                row.innerHTML = `
                    <td>${booking.id.substring(0, 8)}</td>
                    <td>${booking.customerName || '-'}</td>
                    <td>${booking.roomTitle || '-'}</td>
                    <td>${checkInDate}</td>
                    <td>${checkOutDate}</td>
                    <td>${statusBadge}</td>
                    ${showActions ? `<td>${paymentStatus}</td>` : ''}
                    <td>${booking.totalCost || 'Rp 0'}</td>
                    <td>
                        <button class="action-btn view" data-id="${booking.id}">
                            <i class="fas fa-eye"></i> Lihat
                        </button>
                        ${showActions ? `
                        ${booking.status !== 'cancelled' && booking.paymentStatus !== 'paid' ? `
                        <button class="action-btn confirm" data-id="${booking.id}">
                            <i class="fas fa-check"></i> Konfirmasi
                        </button>
                        ` : ''}
                        ${booking.status !== 'cancelled' ? `
                        <button class="action-btn delete" data-id="${booking.id}">
                            <i class="fas fa-times"></i> Batalkan
                        </button>
                        ` : ''}
                        ` : ''}
                    </td>
                `;

                // Add event listeners to buttons
                const viewBtn = row.querySelector('.action-btn.view');
                viewBtn.addEventListener('click', function () {
                    showReservationDetails(booking);
                });

                if (showActions) {
                    if (booking.status !== 'cancelled' && booking.paymentStatus !== 'paid') {
                        const confirmBtn = row.querySelector('.action-btn.confirm');
                        confirmBtn.addEventListener('click', function () {
                            showConfirmModal(booking);
                        });
                    }

                    if (booking.status !== 'cancelled') {
                        const cancelBtn = row.querySelector('.action-btn.delete');
                        cancelBtn.addEventListener('click', function () {
                            showAdminCancelModal(booking);
                        });
                    }
                }

                return row;
            }

            // Show reservation details modal
            function showReservationDetails(booking) {
                currentReservation = booking;

                // Set modal values
                document.getElementById('detailId').textContent = booking.id;
                document.getElementById('detailCustomerName').textContent = booking.customerName || '-';

                // Get email from user data if available
                if (booking.userId) {
                    db.collection('users').doc(booking.userId).get()
                        .then(doc => {
                            if (doc.exists) {
                                document.getElementById('detailCustomerEmail').textContent = doc.data().email || '-';
                            } else {
                                document.getElementById('detailCustomerEmail').textContent = booking.customerEmail || '-';
                            }
                        })
                        .catch(error => {
                            console.error('Error getting user email:', error);
                            document.getElementById('detailCustomerEmail').textContent = booking.customerEmail || '-';
                        });
                } else {
                    document.getElementById('detailCustomerEmail').textContent = booking.customerEmail || '-';
                }

                document.getElementById('detailCustomerPhone').textContent = booking.customerPhone || '-';
                document.getElementById('detailNotes').textContent = booking.KeteranganTambahan || '-';
                document.getElementById('detailRoomType').textContent = booking.roomTitle || '-';

                // Format dates
                try {
                    const checkInDate = new Date(booking.startDate);
                    const checkOutDate = new Date(booking.endDate);

                    document.getElementById('detailCheckIn').textContent =
                        checkInDate.toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                    document.getElementById('detailCheckOut').textContent =
                        checkOutDate.toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

                    // Calculate nights
                    const nights = Math.ceil((checkOutDate - checkInDate) / (1000 * 60 * 60 * 24));
                    document.getElementById('detailNights').textContent = `${nights} Malam`;
                } catch (e) {
                    console.error('Error formatting dates:', e);
                }

                // Guests
                document.getElementById('detailGuests').textContent =
                    `${booking.TotalDWS || 0} Dewasa, ${booking.TotalANK || 0} Anak`;

                // Status
                let statusText = '';
                if (booking.status === 'cancelled') {
                    statusText = 'Dibatalkan';
                } else if (booking.paymentStatus === 'paid') {
                    statusText = 'Terkonfirmasi';
                } else {
                    statusText = 'Menunggu Pembayaran';
                }
                document.getElementById('detailStatus').textContent = statusText;

                // Room price
                if (booking.roomId) {
                    db.collection('rooms').doc(booking.roomId).get()
                        .then(doc => {
                            if (doc.exists) {
                                const roomData = doc.data();
                                document.getElementById('detailRoomPrice').textContent =
                                    `Rp ${roomData.price?.toLocaleString('id-ID') || '0'}`;

                                // Calculate total price
                                if (booking.startDate && booking.endDate) {
                                    try {
                                        const checkInDate = new Date(booking.startDate);
                                        const checkOutDate = new Date(booking.endDate);
                                        const nights = Math.ceil((checkOutDate - checkInDate) / (1000 * 60 * 60 * 24));
                                        const roomPrice = roomData.price || 0;
                                        const total = nights * roomPrice;

                                        document.getElementById('detailTotal').textContent =
                                            `Rp ${total.toLocaleString('id-ID')}`;
                                    } catch (e) {
                                        console.error('Error calculating total:', e);
                                    }
                                }
                            }
                        })
                        .catch(error => {
                            console.error('Error getting room data:', error);
                        });
                } else {
                    document.getElementById('detailRoomPrice').textContent = 'Rp 0';
                    document.getElementById('detailTotal').textContent = booking.totalCost || 'Rp 0';
                }

                // Payment details
                document.getElementById('detailTax').textContent = 'Rp 0';

                // Payment status
                document.getElementById('detailPaymentStatus').textContent =
                    booking.paymentStatus === 'paid' ? 'Lunas' : 'Belum Lunas';
                document.getElementById('detailPaymentMethod').textContent =
                    booking.paymentMethod || '-';

                // Show payment proof if available
                const paymentProofContainer = document.getElementById('paymentProofContainer');
                const paymentProofImage = document.getElementById('paymentProofImage');
                const downloadProofBtn = document.getElementById('downloadProofBtn');

                if (booking.paymentProof) {
                    paymentProofContainer.style.display = 'block';
                    paymentProofImage.src = booking.paymentProof;

                    // Fullscreen view on click
                    paymentProofImage.onclick = function () {
                        Swal.fire({
                            imageUrl: this.src,
                            imageAlt: 'Bukti Pembayaran',
                            showConfirmButton: false,
                            background: 'transparent',
                            backdrop: `
                            rgba(0,0,0,0.8)
                            url("${this.src}")
                            center center
                            no-repeat
                        `,
                            showCloseButton: true,
                            width: '80%'
                        });
                    };

                    // Download functionality
                    document.getElementById('downloadProofBtn').onclick = function () {
                        const link = document.createElement('a');
                        link.href = paymentProofImage.src;
                        link.download = `payment-proof-${booking.id.substring(0, 8)}.jpg`;
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                    };
                } else {
                    paymentProofContainer.style.display = 'none';
                }

                // Show/hide action buttons
                document.getElementById('confirmReservation').style.display =
                    (booking.status !== 'cancelled' && booking.paymentStatus !== 'paid') ? 'block' : 'none';
                document.getElementById('cancelReservation').style.display =
                    (booking.status !== 'cancelled') ? 'block' : 'none';

                // Open modal
                reservationModal.classList.add('active');
            }
            // Close reservation modal
            closeReservationModal.addEventListener('click', function () {
                reservationModal.classList.remove('active');
            });

            closeDetailModal.addEventListener('click', function () {
                reservationModal.classList.remove('active');
            });

            // Show confirm modal
            function showConfirmModal(booking) {
                currentReservation = booking;
                confirmModal.classList.add('active');
            }

            // Close confirm modal
            closeConfirmModal.addEventListener('click', function () {
                confirmModal.classList.remove('active');
            });

            cancelConfirm.addEventListener('click', function () {
                confirmModal.classList.remove('active');
            });

            // Confirm reservation
            confirmReservationBtn.addEventListener('click', function () {
                confirmBooking();
            });

            confirmReservation.addEventListener('click', function () {
                showConfirmModal(currentReservation);
            });

            // Confirm booking function
            function confirmBooking() {
                if (!currentReservation) return;

                Swal.fire({
                    title: 'Mengkonfirmasi reservasi...',
                    allowOutsideClick: false,
                    didOpen: () => Swal.showLoading()
                });

                const updates = {
                    status: 'confirmed',
                    paymentStatus: 'paid',
                    confirmedBy: currentUser.uid,
                    confirmedAt: new Date().toISOString(),
                    roomNumber: assignRoomNumber(currentReservation.roomTitle) // Assign room number
                };

                realtimeDb.ref(`bookings/${currentReservation.id}`).update(updates)
                    .then(() => {
                        // Update room availability
                        if (currentReservation.roomTitle && roomTypes[currentReservation.roomTitle]) {
                            roomTypes[currentReservation.roomTitle].available =
                                Math.max(0, roomTypes[currentReservation.roomTitle].available - 1);

                            // Update the UI
                            countAvailableRooms();
                        }

                        Swal.fire(
                            'Berhasil!',
                            `Reservasi berhasil dikonfirmasi. Nomor Kamar: ${updates.roomNumber}`,
                            'success'
                        );
                        confirmModal.classList.remove('active');
                        reservationModal.classList.remove('active');
                        loadDashboardData();
                        loadRecentBookings();
                        loadAllBookings();
                    })
                    .catch(error => {
                        console.error('Error confirming booking:', error);
                        Swal.fire(
                            'Gagal!',
                            'Terjadi kesalahan saat mengkonfirmasi reservasi.',
                            'error'
                        );
                    });
            }

            // Function to assign room number
            function assignRoomNumber(roomType) {
                if (!roomType || !roomTypes[roomType]) return 'N/A';

                // Simple algorithm to assign room number
                const roomPrefix = roomType.substring(0, 1).toUpperCase();
                const roomNumber = roomTypes[roomType].total - roomTypes[roomType].available;

                return `${roomPrefix}${roomNumber.toString().padStart(2, '0')}`;
            }

            // Show cancel modal
            function showAdminCancelModal(booking) {
                currentReservation = booking;
                adminCancelModal.classList.add('active');
            }

            // Close cancel modal
            closeAdminCancelModal.addEventListener('click', function () {
                adminCancelModal.classList.remove('active');
            });

            cancelAdminCancel.addEventListener('click', function () {
                adminCancelModal.classList.remove('active');
            });

            cancelReservation.addEventListener('click', function () {
                showAdminCancelModal(currentReservation);
            });

            // Cancel reservation
            confirmCancelBtn.addEventListener('click', function () {
                cancelBooking();
            });

            // Cancel booking function
            function cancelBooking() {
                if (!currentReservation) return;

                Swal.fire({
                    title: 'Membatalkan reservasi...',
                    allowOutsideClick: false,
                    didOpen: () => Swal.showLoading()
                });

                const cancelReason = document.getElementById('cancelReason').value;

                const updates = {
                    status: 'cancelled',
                    cancelledBy: currentUser.uid,
                    cancelledAt: new Date().toISOString(),
                    cancelReason: cancelReason || 'Dibatalkan oleh admin'
                };

                realtimeDb.ref(`bookings/${currentReservation.id}`).update(updates)
                    .then(() => {
                        // Release the room if booking was confirmed
                        if (currentReservation.status === 'confirmed' && currentReservation.roomTitle) {
                            releaseRoom(currentReservation.roomTitle, currentReservation.id);

                            // Update the UI
                            countAvailableRooms();
                        }

                        Swal.fire(
                            'Berhasil!',
                            'Reservasi berhasil dibatalkan.',
                            'success'
                        );
                        adminCancelModal.classList.remove('active');
                        reservationModal.classList.remove('active');
                        loadDashboardData();
                        loadRecentBookings();
                        loadAllBookings();
                    })
                    .catch(error => {
                        console.error('Error cancelling booking:', error);
                        Swal.fire(
                            'Gagal!',
                            'Terjadi kesalahan saat membatalkan reservasi.',
                            'error'
                        );
                    });
            }

            // Print reservation as PDF
            printReservation.addEventListener('click', function () {
                const reservationDetailsContent = reservationModal.querySelector('.modal-content'); // Get the content to be printed

                Swal.fire({
                    title: 'Membuat PDF...',
                    text: 'Harap tunggu, data sedang diproses.',
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading();
                    }
                });

                html2canvas(reservationDetailsContent, {
                    scale: 2, // Increase scale for better quality
                    useCORS: true // Important for images loaded from external sources
                }).then(canvas => {
                    const imgData = canvas.toDataURL('image/png');
                    const pdf = new window.jspdf.jsPDF('p', 'mm', 'a4'); // 'p' for portrait, 'mm' for millimeters, 'a4' size
                    const imgWidth = 210; // A4 width in mm
                    const pageHeight = 297; // A4 height in mm
                    const imgHeight = canvas.height * imgWidth / canvas.width;
                    let heightLeft = imgHeight;

                    let position = 0;

                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;

                    while (heightLeft >= 0) {
                        position = heightLeft - imgHeight;
                        pdf.addPage();
                        pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                        heightLeft -= pageHeight;
                    }

                    Swal.close(); // Close loading spinner

                    pdf.save(`reservasi_${currentReservation.id.substring(0, 8)}.pdf`); // Save the PDF

                    Swal.fire({
                        icon: 'success',
                        title: 'PDF Berhasil Dibuat!',
                        text: 'File PDF reservasi telah diunduh.',
                        showConfirmButton: false,
                        timer: 2000
                    });

                }).catch(error => {
                    console.error('Error generating PDF:', error);
                    Swal.fire({
                        icon: 'error',
                        title: 'Gagal Membuat PDF',
                        text: 'Terjadi kesalahan saat membuat file PDF. Silakan coba lagi.',
                    });
                });
            });


            // Refresh buttons
            refreshBookings.addEventListener('click', function () {
                loadRecentBookings();
            });

            refreshAllBookings.addEventListener('click', function () {
                loadAllBookings();
            });

            refreshPayments.addEventListener('click', function () {
                loadPayments();
            });

            // Initialize charts
            function initCharts() {
                // Revenue chart
                const revenueCtx = document.getElementById('revenueChart').getContext('2d');
                revenueChart = new Chart(revenueCtx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun'],
                        datasets: [{
                            label: 'Pendapatan',
                            data: [12000000, 19000000, 15000000, 18000000, 22000000, 25000000],
                            backgroundColor: 'rgba(14, 165, 233, 0.2)',
                            borderColor: 'rgba(14, 165, 233, 1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function (value) {
                                        return 'Rp ' + (value / 1000000) + 'jt';
                                    }
                                }
                            }
                        }
                    }
                });

                // Booking status chart
                const statusCtx = document.getElementById('bookingStatusChart').getContext('2d');
                bookingStatusChart = new Chart(statusCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Terkonfirmasi', 'Menunggu', 'Dibatalkan'],
                        datasets: [{
                            data: [65, 15, 20],
                            backgroundColor: [
                                'rgba(22, 163, 74, 0.7)',
                                'rgba(202, 138, 4, 0.7)',
                                'rgba(220, 38, 38, 0.7)'
                            ],
                            borderColor: [
                                'rgba(22, 163, 74, 1)',
                                'rgba(202, 138, 4, 1)',
                                'rgba(220, 38, 38, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });

                // Load actual data
                loadChartData();
            }

            // Load actual data for charts
            function loadChartData() {
                // Load revenue data for last 6 months
                const months = [];
                const now = new Date();
                for (let i = 5; i >= 0; i--) {
                    const date = new Date(now.getFullYear(), now.getMonth() - i, 1);
                    months.push(date.toLocaleDateString('id-ID', { month: 'short' }));
                }

                revenueChart.data.labels = months;

                // Calculate revenue for each month
                const revenueData = [0, 0, 0, 0, 0, 0];

                realtimeDb.ref('bookings').orderByChild('paymentStatus').equalTo('paid').once('value')
                    .then(snapshot => {
                        snapshot.forEach(booking => {
                            const bookingData = booking.val();
                            const bookingDate = new Date(bookingData.paymentDate || bookingData.timestamp);
                            const monthDiff = (now.getMonth() - bookingDate.getMonth()) +
                                (12 * (now.getFullYear() - bookingDate.getFullYear()));

                            if (monthDiff >= 0 && monthDiff <= 5) {
                                const amount = bookingData.totalCost ?
                                    parseFloat(bookingData.totalCost.replace(/[^0-9]/g, '')) : 0;
                                revenueData[5 - monthDiff] += amount;
                            }
                        });

                        revenueChart.data.datasets[0].data = revenueData;
                        revenueChart.update();
                    })
                    .catch(error => {
                        console.error('Error loading revenue data:', error);
                    });

                // Load booking status data
                realtimeDb.ref('bookings').once('value')
                    .then(snapshot => {
                        let confirmed = 0;
                        let pending = 0;
                        let cancelled = 0;

                        snapshot.forEach(booking => {
                            const bookingData = booking.val();
                            if (bookingData.status === 'cancelled') {
                                cancelled++;
                            } else if (bookingData.paymentStatus === 'paid') {
                                confirmed++;
                            } else {
                                pending++;
                            }
                        });

                        bookingStatusChart.data.datasets[0].data = [confirmed, pending, cancelled];
                        bookingStatusChart.update();
                    })
                    .catch(error => {
                        console.error('Error loading status data:', error);
                    });
            }

            // Report type change
            reportType.addEventListener('change', function () {
                const type = this.value;

                if (type === 'monthly') {
                    monthYearGroup.style.display = 'block';
                    yearGroup.style.display = 'none';
                    customDateGroup.style.display = 'none';
                } else if (type === 'annual') {
                    monthYearGroup.style.display = 'none';
                    yearGroup.style.display = 'block';
                    customDateGroup.style.display = 'none';
                } else {
                    monthYearGroup.style.display = 'none';
                    yearGroup.style.display = 'none';
                    customDateGroup.style.display = 'flex';
                }
            });

            // Generate report
            generateReport.addEventListener('click', function () {
                const type = reportType.value;
                let startDate, endDate;

                if (type === 'monthly') {
                    const monthValue = document.getElementById('reportMonth').value;
                    if (!monthValue) {
                        showAlert('Pilih bulan dan tahun terlebih dahulu', 'error');
                        return;
                    }

                    const [year, month] = monthValue.split('-');
                    startDate = new Date(year, month - 1, 1);
                    endDate = new Date(year, month, 0);
                } else if (type === 'annual') {
                    const year = document.getElementById('reportYear').value;
                    startDate = new Date(year, 0, 1);
                    endDate = new Date(year, 11, 31);
                } else {
                    startDate = new Date(document.getElementById('reportStartDate').value);
                    endDate = new Date(document.getElementById('reportEndDate').value);

                    if (!startDate || !endDate || isNaN(startDate.getTime()) || isNaN(endDate.getTime())) {
                        showAlert('Pilih tanggal yang valid', 'error');
                        return;
                    }

                    if (startDate > endDate) {
                        showAlert('Tanggal mulai tidak boleh setelah tanggal akhir', 'error');
                        return;
                    }
                }

                generateBookingReport(startDate, endDate);
            });

            // Generate booking report
            // Perbaikan pada fungsi generateBookingReport
            function generateBookingReport(startDate, endDate) {
                Swal.fire({
                    title: 'Membuat laporan...',
                    text: 'Harap tunggu, data sedang diproses.',
                    allowOutsideClick: false,
                    didOpen: () => Swal.showLoading()
                });

                // Format tanggal awal dan akhir agar sesuai dengan timestamp di Firebase (ISO string)
                // Jika timestamp Anda di Firebase disimpan sebagai string YYYY-MM-DDTHH:mm:ss.sssZ,
                // maka perbandingan string ini akan berfungsi.
                // Penting: Pastikan startDate diatur ke awal hari (00:00:00) dan endDate ke akhir hari (23:59:59)
                const startISO = new Date(startDate.getFullYear(), startDate.getMonth(), startDate.getDate(), 0, 0, 0, 0).toISOString();
                const endISO = new Date(endDate.getFullYear(), endDate.getMonth(), endDate.getDate(), 23, 59, 59, 999).toISOString();


                realtimeDb.ref('bookings')
                    .orderByChild('timestamp')
                    .startAt(startISO)
                    .endAt(endISO)
                    .once('value')
                    .then(snapshot => {
                        const bookings = [];
                        let totalRevenue = 0;

                        snapshot.forEach(booking => {
                            const bookingData = booking.val();
                            const bookingDate = new Date(bookingData.timestamp);

                            // Tambahan validasi untuk memastikan data ada di dalam rentang tanggal
                            // Meskipun sudah difilter oleh Firebase, ini bagus sebagai sanity check
                            if (bookingDate >= startDate && bookingDate <= endDate) {
                                bookings.push({
                                    id: booking.key,
                                    ...bookingData
                                });

                                // Hanya hitung pendapatan dari reservasi yang LUNAS
                                if (bookingData.paymentStatus === 'paid') {
                                    const amount = bookingData.totalCost ?
                                        parseFloat(String(bookingData.totalCost).replace(/[^0-9]/g, '')) : 0; // Pastikan string sebelum replace
                                    totalRevenue += amount;
                                }
                            }
                        });

                        // Urutkan berdasarkan tanggal (terbaru ke terlama)
                        bookings.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

                        // Tampilkan hasil laporan
                        displayReportResults(bookings, totalRevenue);

                        Swal.close();
                    })
                    .catch(error => {
                        console.error('Error generating report:', error);
                        Swal.fire(
                            'Gagal!',
                            'Terjadi kesalahan saat membuat laporan. Pastikan format tanggal di database benar (ISO String).',
                            'error'
                        );
                    });
            }

            // Tambahkan event listener untuk tombol cetak laporan
            printReport.addEventListener('click', function () {
                const reportContent = document.getElementById('reportResults'); // Target div hasil laporan

                if (reportContent.style.display === 'none' || reportContent.querySelectorAll('#reportTable tbody tr').length === 0) {
                    showAlert('Harap buat laporan terlebih dahulu sebelum mencetak.', 'warning');
                    return;
                }

                Swal.fire({
                    title: 'Membuat PDF Laporan...',
                    text: 'Harap tunggu, data laporan sedang diproses.',
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading();
                    }
                });

                html2canvas(reportContent, {
                    scale: 2, // Meningkatkan skala untuk kualitas yang lebih baik
                    useCORS: true, // Penting jika ada gambar dari sumber eksternal
                    logging: false, // Nonaktifkan logging html2canvas di konsol
                }).then(canvas => {
                    const imgData = canvas.toDataURL('image/png');
                    const pdf = new window.jspdf.jsPDF('p', 'mm', 'a4');
                    const imgWidth = 210; // Lebar A4 dalam mm
                    const pageHeight = 297; // Tinggi A4 dalam mm
                    const imgHeight = canvas.height * imgWidth / canvas.width;
                    let heightLeft = imgHeight;
                    let position = 0;

                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;

                    while (heightLeft >= 0) {
                        position = heightLeft - imgHeight;
                        pdf.addPage();
                        pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                        heightLeft -= pageHeight;
                    }

                    Swal.close(); // Tutup loading spinner

                    // Dapatkan periode laporan untuk nama file
                    const reportTypeVal = document.getElementById('reportType').value;
                    let filename = 'laporan_reservasi.pdf';
                    if (reportTypeVal === 'monthly') {
                        const monthYear = document.getElementById('reportMonth').value;
                        filename = `laporan_bulanan_${monthYear}.pdf`;
                    } else if (reportTypeVal === 'annual') {
                        const year = document.getElementById('reportYear').value;
                        filename = `laporan_tahunan_${year}.pdf`;
                    } else if (reportTypeVal === 'custom') {
                        const startDate = document.getElementById('reportStartDate').value;
                        const endDate = document.getElementById('reportEndDate').value;
                        filename = `laporan_kustom_${startDate}_${endDate}.pdf`;
                    }

                    pdf.save(filename); // Simpan PDF

                    Swal.fire({
                        icon: 'success',
                        title: 'PDF Laporan Berhasil Dibuat!',
                        text: 'File PDF laporan telah diunduh.',
                        showConfirmButton: false,
                        timer: 2000
                    });

                }).catch(error => {
                    console.error('Error generating report PDF:', error);
                    Swal.fire({
                        icon: 'error',
                        title: 'Gagal Membuat PDF Laporan',
                        text: 'Terjadi kesalahan saat membuat file PDF laporan. Silakan coba lagi.',
                    });
                });
            });

            // Display report results
            function displayReportResults(bookings, totalRevenue) {
                const tbody = document.querySelector('#reportTable tbody');
                tbody.innerHTML = '';

                if (bookings.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">Tidak ada data untuk periode ini</td></tr>';
                } else {
                    bookings.forEach(booking => {
                        const row = document.createElement('tr');

                        // Format dates
                        let checkInDate = 'Invalid Date';
                        let checkOutDate = 'Invalid Date';
                        try {
                            checkInDate = new Date(booking.startDate).toLocaleDateString('id-ID');
                            checkOutDate = new Date(booking.endDate).toLocaleDateString('id-ID');
                        } catch (e) {
                            console.error('Error formatting dates:', e);
                        }

                        // Status
                        let statusText = '';
                        let statusClass = '';
                        if (booking.status === 'cancelled') {
                            statusText = 'Dibatalkan';
                            statusClass = 'status-cancelled';
                        } else if (booking.paymentStatus === 'paid') {
                            statusText = 'Terkonfirmasi';
                            statusClass = 'status-confirmed';
                        } else if (booking.status === 'pending') {
                            statusText = 'Menunggu';
                            statusClass = 'status-pending';
                        } else {
                            statusText = 'Pending';
                            statusClass = 'status-pending';
                        }

                        // Format total cost
                        let totalCost = 'Rp 0';
                        try {
                            if (booking.totalCost) {
                                if (typeof booking.totalCost === 'string') {
                                    totalCost = `Rp ${parseFloat(booking.totalCost.replace(/[^0-9]/g, '')).toLocaleString('id-ID')}`;
                                } else {
                                    totalCost = `Rp ${booking.totalCost.toLocaleString('id-ID')}`;
                                }
                            }
                        } catch (e) {
                            console.error('Error formatting total cost:', e);
                        }

                        row.innerHTML = `
                            <td>${booking.id?.substring(0, 8) || '-'}</td>
                            <td>${booking.customerName || '-'}</td>
                            <td>${booking.roomTitle || '-'}</td>
                            <td>${checkInDate}</td>
                            <td>${checkOutDate}</td>
                            <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                            <td>${totalCost}</td>
                        `;

                        tbody.appendChild(row);
                    });
                }

                // Update summary information
                document.getElementById('reportTotal').textContent = `Rp ${totalRevenue.toLocaleString('id-ID')}`;
                document.getElementById('reportCount').textContent = bookings.length;

                // Show results section
                reportResults.style.display = 'block';
                printReport.disabled = false;

                // Update pagination info
                const paginationInfo = document.querySelector('#reportResults .pagination-info');
                if (paginationInfo) {
                    paginationInfo.textContent = `Menampilkan ${bookings.length} dari ${bookings.length} data`;
                }
            }

            // Print report
            printReport.addEventListener('click', function () {
                window.print();
            });

            // Load rooms
            function loadRooms() {
                const tbody = document.querySelector('#roomsTable tbody');
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">Memuat data...</td></tr>';

                db.collection('rooms').get()
                    .then(snapshot => {
                        tbody.innerHTML = '';

                        if (snapshot.empty) {
                            tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">Tidak ada data kamar</td></tr>';
                            return;
                        }

                        snapshot.forEach(doc => {
                            const room = {
                                id: doc.id,
                                ...doc.data()
                            };

                            const row = createRoomRow(room);
                            tbody.appendChild(row);
                        });
                    })
                    .catch(error => {
                        console.error('Error loading rooms:', error);
                        tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">Gagal memuat data</td></tr>';
                    });
            }

            // Create room row
            function createRoomRow(room) {
                const row = document.createElement('tr');

                row.innerHTML = `
                    <td>${room.id}</td>
                    <td>${room.type}</td>
                    <td>Rp ${room.price?.toLocaleString('id-ID') || '0'}</td>
                    <td>${room.capacity || '0'} Orang</td>
                    <td>${room.amenities?.join(', ') || '-'}</td>
                    <td>
                        <span class="status-badge ${room.status === 'available' ? 'status-confirmed' : 'status-cancelled'}">
                            ${room.status === 'available' ? 'Tersedia' : 'Tidak Tersedia'}
                        </span>
                    </td>
                    <td>
                        <button class="action-btn edit" data-id="${room.id}">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="action-btn delete" data-id="${room.id}">
                            <i class="fas fa-trash"></i> Hapus
                        </button>
                    </td>
                `;

                // Add event listeners to buttons
                const editBtn = row.querySelector('.action-btn.edit');
                editBtn.addEventListener('click', function () {
                    editRoom(room);
                });

                const deleteBtn = row.querySelector('.action-btn.delete');
                deleteBtn.addEventListener('click', function () {
                    deleteRoom(room.id);
                });

                return row;
            }

            // Add new room
            addRoomBtn.addEventListener('click', function () {
                roomModalTitle.textContent = 'Tambah Kamar Baru';
                roomForm.reset();
                currentRoom = null;
                roomModal.classList.add('active');
            });

            // Edit room
            function editRoom(room) {
                roomModalTitle.textContent = 'Edit Kamar';
                currentRoom = room;

                // Fill form
                document.getElementById('roomType').value = room.type || '';
                document.getElementById('roomPrice').value = room.price || '';
                document.getElementById('roomCapacity').value = room.capacity || '';
                document.getElementById('roomQuantity').value = room.quantity || '';
                document.getElementById('roomAmenities').value = room.amenities?.join(', ') || '';
                document.getElementById('roomDescription').value = room.description || '';
                document.getElementById('roomImage').value = room.image || '';

                roomModal.classList.add('active');
            }

            // Close room modal
            closeRoomModal.addEventListener('click', function () {
                roomModal.classList.remove('active');
            });

            cancelRoomBtn.addEventListener('click', function () {
                roomModal.classList.remove('active');
            });

            // Form validation for room
            function validateRoomForm() {
                let isValid = true;
                const formGroups = roomForm.querySelectorAll('.form-group');

                formGroups.forEach(group => {
                    const input = group.querySelector('.form-input');
                    const errorMessage = group.querySelector('.error-message');

                    if (input.required && !input.value.trim()) {
                        group.classList.add('error');
                        isValid = false;
                    } else {
                        group.classList.remove('error');
                    }
                });

                return isValid;
            }

            // Save room
            roomForm.addEventListener('submit', function (e) {
                e.preventDefault();

                if (!validateRoomForm()) {
                    showAlert('Harap isi semua field yang wajib diisi', 'error');
                    return;
                }

                const roomData = {
                    type: document.getElementById('roomType').value,
                    price: parseFloat(document.getElementById('roomPrice').value),
                    capacity: parseInt(document.getElementById('roomCapacity').value),
                    quantity: parseInt(document.getElementById('roomQuantity').value),
                    amenities: document.getElementById('roomAmenities').value.split(',').map(item => item.trim()),
                    description: document.getElementById('roomDescription').value,
                    image: document.getElementById('roomImage').value,
                    status: 'available',
                    updatedAt: new Date().toISOString()
                };

                Swal.fire({
                    title: 'Menyimpan kamar...',
                    allowOutsideClick: false,
                    didOpen: () => Swal.showLoading()
                });

                if (currentRoom) {
                    // Update existing room
                    db.collection('rooms').doc(currentRoom.id).update(roomData)
                        .then(() => {
                            Swal.fire(
                                'Berhasil!',
                                'Kamar berhasil diperbarui.',
                                'success'
                            );
                            roomModal.classList.remove('active');
                            loadRooms();
                        })
                        .catch(error => {
                            console.error('Error updating room:', error);
                            Swal.fire(
                                'Gagal!',
                                'Terjadi kesalahan saat memperbarui kamar.',
                                'error'
                            );
                        });
                } else {
                    // Add new room
                    roomData.createdAt = new Date().toISOString();

                    db.collection('rooms').add(roomData)
                        .then(() => {
                            Swal.fire(
                                'Berhasil!',
                                'Kamar baru berhasil ditambahkan.',
                                'success'
                            );
                            roomModal.classList.remove('active');
                            loadRooms();
                        })
                        .catch(error => {
                            console.error('Error adding room:', error);
                            Swal.fire(
                                'Gagal!',
                                'Terjadi kesalahan saat menambahkan kamar.',
                                'error'
                            );
                        });
                }
            });

            // Delete room
            function deleteRoom(roomId) {
                Swal.fire({
                    title: 'Apakah Anda yakin?',
                    text: "Anda tidak akan dapat mengembalikan data ini!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Ya, hapus!',
                    cancelButtonText: 'Batal'
                }).then((result) => {
                    if (result.isConfirmed) {
                        Swal.fire({
                            title: 'Menghapus kamar...',
                            allowOutsideClick: false,
                            didOpen: () => Swal.showLoading()
                        });

                        db.collection('rooms').doc(roomId).delete()
                            .then(() => {
                                Swal.fire(
                                    'Terhapus!',
                                    'Kamar telah dihapus.',
                                    'success'
                                );
                                loadRooms();
                            })
                            .catch(error => {
                                console.error('Error deleting room:', error);
                                Swal.fire(
                                    'Gagal!',
                                    'Terjadi kesalahan saat menghapus kamar.',
                                    'error'
                                );
                            });
                    }
                });
            }

            // Load users
            function loadUsers() {
                const tbody = document.querySelector('#usersTable tbody');
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">Memuat data...</td></tr>';

                db.collection('users').get()
                    .then(snapshot => {
                        tbody.innerHTML = '';

                        if (snapshot.empty) {
                            tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">Tidak ada data pengguna</td></tr>';
                            return;
                        }

                        snapshot.forEach(doc => {
                            const user = {
                                id: doc.id,
                                ...doc.data()
                            };

                            const row = createUserRow(user);
                            tbody.appendChild(row);
                        });
                    })
                    .catch(error => {
                        console.error('Error loading users:', error);
                        tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">Gagal memuat data</td></tr>';
                    });
            }

            // Create user row
            function createUserRow(user) {
                const row = document.createElement('tr');

                // Format registration date
                let regDate = 'Invalid Date';
                try {
                    if (user.createdAt) {
                        regDate = new Date(user.createdAt).toLocaleDateString('id-ID');
                    } else if (user.metadata?.creationTime) {
                        regDate = new Date(user.metadata.creationTime).toLocaleDateString('id-ID');
                    }
                } catch (e) {
                    console.error('Error formatting date:', e);
                }

                row.innerHTML = `
                    <td>${user.id.substring(0, 8)}</td>
                    <td>${user.name || '-'}</td>
                    <td>${user.email || '-'}</td>
                    <td>${user.role ? user.role.charAt(0).toUpperCase() + user.role.slice(1) : '-'}</td>
                    <td>${regDate}</td>
                    <td>
                        <span class="status-badge ${user.status === 'active' ? 'status-confirmed' : 'status-cancelled'}">
                            ${user.status === 'active' ? 'Aktif' : 'Nonaktif'}
                        </span>
                    </td>
                    <td>
                        <button class="action-btn edit" data-id="${user.id}">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        ${user.role !== 'admin' ? `
                        <button class="action-btn delete" data-id="${user.id}">
                            <i class="fas fa-trash"></i> Hapus
                        </button>
                        ` : ''}
                    </td>
                `;

                // Add event listeners to buttons
                const editBtn = row.querySelector('.action-btn.edit');
                editBtn.addEventListener('click', function () {
                    editUser(user);
                });

                if (user.role !== 'admin') {
                    const deleteBtn = row.querySelector('.action-btn.delete');
                    deleteBtn.addEventListener('click', function () {
                        deleteUser(user.id);
                    });
                }

                return row;
            }

            // Add new user
            addUserBtn.addEventListener('click', function () {
                userModalTitle.textContent = 'Tambah Pengguna Baru';
                userForm.reset();
                currentEditUser = null;
                passwordFields.style.display = 'flex';
                document.getElementById('userEmail').disabled = false;
                document.getElementById('userPassword').required = true;
                document.getElementById('userConfirmPassword').required = true;
                userModal.classList.add('active');
            });

            // Edit user
            function editUser(user) {
                userModalTitle.textContent = 'Edit Pengguna';
                currentEditUser = user;

                // Fill form
                document.getElementById('userName').value = user.name || '';
                document.getElementById('userEmail').value = user.email || '';
                document.getElementById('userRole').value = user.role || 'guest';
                document.getElementById('userStatus').value = user.status || 'active';
                document.getElementById('userPhone').value = user.phone || '';

                // Disable email field for existing user
                document.getElementById('userEmail').disabled = true;
                passwordFields.style.display = 'none';
                document.getElementById('userPassword').required = false;
                document.getElementById('userConfirmPassword').required = false;

                userModal.classList.add('active');
            }

            // Close user modal
            closeUserModal.addEventListener('click', function () {
                userModal.classList.remove('active');
            });

            cancelUserBtn.addEventListener('click', function () {
                userModal.classList.remove('active');
            });

            // Form validation for user
            function validateUserForm() {
                let isValid = true;
                const formGroups = userForm.querySelectorAll('.form-group');

                formGroups.forEach(group => {
                    const input = group.querySelector('.form-input, select');
                    const errorMessage = group.querySelector('.error-message');

                    if (input.required && !input.value.trim()) {
                        group.classList.add('error');
                        isValid = false;
                    } else if (input.id === 'userEmail' && !isValidEmail(input.value)) {
                        group.classList.add('error');
                        errorMessage.textContent = 'Email tidak valid';
                        isValid = false;
                    } else if (input.id === 'userPassword' && input.value.length < 6) {
                        group.classList.add('error');
                        errorMessage.textContent = 'Password minimal 6 karakter';
                        isValid = false;
                    } else if (input.id === 'userConfirmPassword' &&
                        input.value !== document.getElementById('userPassword').value) {
                        group.classList.add('error');
                        errorMessage.textContent = 'Password tidak cocok';
                        isValid = false;
                    } else {
                        group.classList.remove('error');
                    }
                });

                return isValid;
            }

            // Email validation
            function isValidEmail(email) {
                return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
            }

            // Save user
            userForm.addEventListener('submit', function (e) {
                e.preventDefault();

                if (!validateUserForm()) {
                    showAlert('Harap perbaiki kesalahan pada form', 'error');
                    return;
                }

                const userData = {
                    name: document.getElementById('userName').value,
                    email: document.getElementById('userEmail').value,
                    role: document.getElementById('userRole').value,
                    status: document.getElementById('userStatus').value,
                    phone: document.getElementById('userPhone').value,
                    updatedAt: new Date().toISOString()
                };

                Swal.fire({
                    title: 'Menyimpan pengguna...',
                    allowOutsideClick: false,
                    didOpen: () => Swal.showLoading()
                });

                if (currentEditUser) {
                    // Update existing user
                    db.collection('users').doc(currentEditUser.id).update(userData)
                        .then(() => {
                            Swal.fire(
                                'Berhasil!',
                                'Pengguna berhasil diperbarui.',
                                'success'
                            );
                            userModal.classList.remove('active');
                            loadUsers();
                        })
                        .catch(error => {
                            console.error('Error updating user:', error);
                            Swal.fire(
                                'Gagal!',
                                'Terjadi kesalahan saat memperbarui pengguna.',
                                'error'
                            );
                        });
                } else {
                    // Create new user
                    const password = document.getElementById('userPassword').value;
                    const email = document.getElementById('userEmail').value;

                    auth.createUserWithEmailAndPassword(email, password)
                        .then((userCredential) => {
                            const userId = userCredential.user.uid;

                            userData.email = email;
                            userData.createdAt = new Date().toISOString();

                            return db.collection('users').doc(userId).set(userData);
                        })
                        .then(() => {
                            Swal.fire(
                                'Berhasil!',
                                'Pengguna baru berhasil ditambahkan.',
                                'success'
                            );
                            userModal.classList.remove('active');
                            loadUsers();
                        })
                        .catch(error => {
                            console.error('Error adding user:', error);
                            Swal.fire(
                                'Gagal!',
                                'Terjadi kesalahan saat menambahkan pengguna.',
                                'error'
                            );
                        });
                }
            });

            // Delete user
            function deleteUser(userId) {
                Swal.fire({
                    title: 'Apakah Anda yakin?',
                    text: "Anda tidak akan dapat mengembalikan data ini!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Ya, hapus!',
                    cancelButtonText: 'Batal'
                }).then((result) => {
                    if (result.isConfirmed) {
                        Swal.fire({
                            title: 'Menghapus pengguna...',
                            allowOutsideClick: false,
                            didOpen: () => Swal.showLoading()
                        });

                        // Delete from Firestore
                        db.collection('users').doc(userId).delete()
                            .then(() => {
                                // Delete from Authentication
                                // Note: Deleting a user from Firebase Authentication requires admin privileges on the server-side,
                                // or the user itself to delete their account. This client-side delete will only remove from Firestore.
                                // For full deletion, you'd typically use a Firebase Cloud Function or your backend.
                                // If you want to simulate full deletion for a client-side only app, you'd need to bypass auth.deleteUser()
                                // or handle the error gracefully. For simplicity, we'll assume Firestore deletion is enough for this example.
                                return Promise.resolve(); // Simulate success for demo purposes if auth.deleteUser is not applicable client-side directly
                            })
                            .then(() => {
                                Swal.fire(
                                    'Terhapus!',
                                    'Pengguna telah dihapus.',
                                    'success'
                                );
                                loadUsers();
                            })
                            .catch(error => {
                                console.error('Error deleting user:', error);
                                Swal.fire(
                                    'Gagal!',
                                    'Terjadi kesalahan saat menghapus pengguna. (Coba lagi jika ini bukan akun yang sedang login)',
                                    'error'
                                );
                            });
                    }
                });
            }

            // Load messages
            function loadMessages() {
                const tbody = document.querySelector('#messagesTable tbody');
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center;">Memuat data...</td></tr>';

                db.collection('messages').orderBy('timestamp', 'desc').get()
                    .then(snapshot => {
                        tbody.innerHTML = '';

                        if (snapshot.empty) {
                            tbody.innerHTML = '<tr><td colspan="6" style="text-align: center;">Tidak ada pesan</td></tr>';
                            document.getElementById('newMessagesCount').textContent = '0';
                            document.getElementById('totalMessagesCount').textContent = '0';
                            document.getElementById('unreadBadge').style.display = 'none';
                            return;
                        }

                        let unreadCount = 0;
                        snapshot.forEach(doc => {
                            const message = {
                                id: doc.id,
                                ...doc.data()
                            };

                            // Count unread messages
                            if (!message.isRead) {
                                unreadCount++;
                            }

                            const row = createMessageRow(message);
                            tbody.appendChild(row);
                        });

                        // Update counters
                        document.getElementById('newMessagesCount').textContent = unreadCount.toString();
                        document.getElementById('totalMessagesCount').textContent = snapshot.size.toString();

                        // Update unread badge in sidebar
                        const unreadBadge = document.getElementById('unreadBadge');
                        if (unreadCount > 0) {
                            badge.textContent = unreadCount;
                            badge.classList.add('visible'); // Add class to show
                        } else {
                            badge.classList.remove('visible'); // Remove class to hide
                        }


                        // Update pagination info
                        document.querySelector('#messages .pagination-info').textContent =
                            `Menampilkan ${snapshot.size} dari ${snapshot.size} data`;
                    })
                    .catch(error => {
                        console.error('Error loading messages:', error);
                        tbody.innerHTML = '<tr><td colspan="6" style="text-align: center;">Gagal memuat data</td></tr>';
                    });
            }

            // Create a table row for a message
            function createMessageRow(message) {
                const row = document.createElement('tr');

                // Format date
                let messageDate = 'Invalid Date';
                try {
                    messageDate = new Date(message.timestamp).toLocaleDateString('id-ID', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                } catch (e) {
                    console.error('Error formatting date:', e);
                }

                // Status badge
                let statusBadge = '';
                if (message.isReplied) {
                    statusBadge = '<span class="status-badge status-replied">Dibalas</span>';
                } else if (message.isRead) {
                    statusBadge = '<span class="status-badge status-read">Dibaca</span>';
                } else {
                    statusBadge = '<span class="status-badge status-unread">Belum Dibaca</span>';
                }

                // Apply bold style to unread messages
                const fontWeight = message.isRead ? 'normal' : 'bold';

                row.innerHTML = `
                    <td style="font-weight: ${fontWeight};">${messageDate}</td>
                    <td style="font-weight: ${fontWeight};">${message.name}</td>
                    <td style="font-weight: ${fontWeight};">${message.email}</td>
                    <td style="font-weight: ${fontWeight};">${message.subject}</td>
                    <td>${statusBadge}</td>
                    <td>
                        <button class="action-btn view" data-id="${message.id}">
                            <i class="fas fa-eye"></i> Lihat
                        </button>
                        <button class="action-btn delete" data-id="${message.id}">
                            <i class="fas fa-trash"></i> Hapus
                        </button>
                    </td>
                `;

                // Add event listeners to buttons
                const viewBtn = row.querySelector('.action-btn.view');
                viewBtn.addEventListener('click', function () {
                    showMessageDetails(message.id);
                });

                const deleteBtn = row.querySelector('.action-btn.delete');
                deleteBtn.addEventListener('click', function () {
                    deleteMessage(message.id);
                });

                return row;
            }

            // Show message details
            function showMessageDetails(messageId) {
                // Fetch the message data
                db.collection('messages').doc(messageId).get()
                    .then(doc => {
                        if (doc.exists) {
                            currentCustomerMessage = {
                                id: doc.id,
                                ...doc.data()
                            };

                            // Format date
                            let messageDate = 'Invalid Date';
                            try {
                                messageDate = new Date(currentCustomerMessage.timestamp).toLocaleDateString('id-ID', {
                                    weekday: 'long',
                                    year: 'numeric',
                                    month: 'long',
                                    day: 'numeric',
                                    hour: '2-digit',
                                    minute: '2-digit'
                                });
                            } catch (e) {
                                console.error('Error formatting date:', e);
                            }

                            // Set modal values
                            document.getElementById('messageFrom').textContent = currentCustomerMessage.name;
                            document.getElementById('messageEmail').textContent = currentCustomerMessage.email;
                            document.getElementById('messageDate').textContent = messageDate;
                            document.getElementById('messageSubject').textContent = currentCustomerMessage.subject;
                            document.getElementById('messageContent').textContent = currentCustomerMessage.message;

                            // Show or hide "Mark as Read" button based on status
                            document.getElementById('markAsRead').style.display = currentCustomerMessage.isRead ? 'none' : 'block';

                            // If the message is not read, mark it as read
                            if (!currentCustomerMessage.isRead) {
                                db.collection('messages').doc(messageId).update({
                                    isRead: true
                                }).then(() => {
                                    // Refresh messages list to update counters
                                    loadMessages();
                                }).catch(error => {
                                    console.error('Error marking message as read:', error);
                                });
                            }

                            // Show the modal
                            document.getElementById('messageModal').classList.add('active');
                        } else {
                            showAlert('Pesan tidak ditemukan', 'error');
                        }
                    })
                    .catch(error => {
                        console.error('Error getting message:', error);
                        showAlert('Gagal memuat pesan', 'error');
                    });
            }

            // Mark message as read
            markAsRead.addEventListener('click', function () {
                if (!currentCustomerMessage) return;

                markMessageAsRead(currentCustomerMessage.id);
            });

            // Mark message as read function
            function markMessageAsRead(messageId) {
                if (!messageId) return;

                Swal.fire({
                    title: 'Menandai pesan...',
                    allowOutsideClick: false,
                    didOpen: () => Swal.showLoading()
                });

                db.collection('messages').doc(messageId).update({
                    isRead: true,
                    readAt: new Date().toISOString()
                })
                    .then(() => {
                        Swal.fire(
                            'Berhasil!',
                            'Pesan telah ditandai sebagai sudah dibaca.',
                            'success'
                        );

                        // Hide the "Mark as Read" button
                        document.getElementById('markAsRead').style.display = 'none';

                        // Update the current message
                        if (currentCustomerMessage) {
                            currentCustomerMessage.isRead = true;
                        }

                        // Refresh messages list
                        loadMessages();
                    })
                    .catch(error => {
                        console.error('Error marking message as read:', error);
                        Swal.fire(
                            'Gagal!',
                            'Terjadi kesalahan saat menandai pesan.',
                            'error'
                        );
                    });
            }

            // Delete a message
            function deleteMessage(messageId) {
                Swal.fire({
                    title: 'Hapus Pesan?',
                    text: "Anda tidak akan dapat mengembalikan pesan ini!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#dc2626',
                    cancelButtonColor: '#64748b',
                    confirmButtonText: 'Ya, Hapus!',
                    cancelButtonText: 'Batal'
                }).then((result) => {
                    if (result.isConfirmed) {
                        db.collection('messages').doc(messageId).delete()
                            .then(() => {
                                showAlert('Pesan berhasil dihapus', 'success');
                                loadMessages();
                            })
                            .catch(error => {
                                console.error('Error deleting message:', error);
                                showAlert('Gagal menghapus pesan', 'error');
                            });
                    }
                });
            }

            // Send reply to customer
            sendReply.addEventListener('click', function () {
                if (!currentCustomerMessage) return;

                const replyText = document.getElementById('replyMessage').value.trim();
                if (!replyText) {
                    showAlert('Harap isi pesan balasan', 'error');
                    return;
                }

                Swal.fire({
                    title: 'Mengirim balasan...',
                    allowOutsideClick: false,
                    didOpen: () => Swal.showLoading()
                });

                // Save reply to Firebase
                const replyData = {
                    messageId: currentCustomerMessage.id,
                    customerName: currentCustomerMessage.name,
                    customerEmail: currentCustomerMessage.email,
                    originalSubject: currentCustomerMessage.subject,
                    replyText: replyText,
                    adminName: document.getElementById('loggedUsername').textContent,
                    adminId: currentUser.uid,
                    timestamp: new Date().toISOString()
                };

                // Add reply to replies collection
                db.collection('messageReplies').add(replyData)
                    .then(() => {
                        // Update original message
                        return db.collection('messages').doc(currentCustomerMessage.id).update({
                            isReplied: true,
                            isRead: true,
                            repliedAt: new Date().toISOString(),
                            repliedBy: currentUser.uid
                        });
                    })
                    .then(() => {
                        Swal.fire(
                            'Berhasil!',
                            'Balasan telah dikirim kepada pelanggan.',
                            'success'
                        );

                        // Clear reply form
                        document.getElementById('replyMessage').value = '';

                        // Close modal
                        document.getElementById('messageModal').classList.remove('active');

                        // Refresh messages
                        loadMessages();
                    })
                    .catch(error => {
                        console.error('Error sending reply:', error);
                        Swal.fire(
                            'Gagal!',
                            'Terjadi kesalahan saat mengirim balasan.',
                            'error'
                        );
                    });
            });

            // Close message modal
            document.getElementById('closeMessageModal').addEventListener('click', function () {
                document.getElementById('messageModal').classList.remove('active');
            });

            document.getElementById('closeMessageDetailModal').addEventListener('click', function () {
                document.getElementById('messageModal').classList.remove('active');
            });

            // Refresh messages
            refreshMessages.addEventListener('click', function () {
                loadMessages();
            });

            // Count unread messages
            function countUnreadMessages() {
                return db.collection('messages')
                    .where('isRead', '==', false)
                    .get()
                    .then(snapshot => snapshot.size);
            }

            // Update unread badge
            function updateUnreadBadge(count) {
                const badge = document.getElementById('unreadBadge');
                if (!badge) return;

                if (count > 0) {
                    badge.textContent = count;
                    badge.classList.add('visible'); // Add class to show
                } else {
                    badge.classList.remove('visible'); // Remove class to hide
                }
            }


            // Setup messages listener for real-time updates
            function setupMessagesListener() {
                db.collection('messages').onSnapshot(snapshot => {
                    countUnreadMessages().then(count => {
                        updateUnreadBadge(count);
                        document.getElementById('newMessagesCount').textContent = count;
                    });
                });
            }

            // Close modals when clicking outside
            window.addEventListener('click', function (event) {
                if (event.target === reservationModal) {
                    reservationModal.classList.remove('active');
                }
                if (event.target === confirmModal) {
                    confirmModal.classList.remove('active');
                }
                if (event.target === adminCancelModal) {
                    adminCancelModal.classList.remove('active');
                }
                if (event.target === roomModal) {
                    roomModal.classList.remove('active');
                }
                if (event.target === userModal) {
                    userModal.classList.remove('active');
                }
                if (event.target === document.getElementById('messageModal')) {
                    document.getElementById('messageModal').classList.remove('active');
                }
            });

            // Initialize date inputs
            function initDateInputs() {
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');

                // Set default value for report month input
                document.getElementById('reportMonth').value = `${year}-${month}`;

                // Set default value for custom date inputs
                document.getElementById('reportStartDate').value = `${year}-${month}-01`;
                document.getElementById('reportEndDate').value = `${year}-${month}-${day}`;
            }

            // Initialize the application
            function initApp() {
                initDateInputs();

                // Set current year in report year select
                const currentYear = new Date().getFullYear();
                const reportYearSelect = document.getElementById('reportYear');
                reportYearSelect.innerHTML = '';

                for (let i = -1; i <= 1; i++) {
                    const year = currentYear + i;
                    const option = document.createElement('option');
                    option.value = year;
                    option.textContent = year;
                    if (i === 0) option.selected = true;
                    reportYearSelect.appendChild(option);
                }
            }

            // Helper function to show alerts
            function showAlert(message, type) {
                Swal.fire({
                    title: type === 'success' ? 'Berhasil!' : 'Error!',
                    text: message,
                    icon: type,
                    timer: 3000,
                    showConfirmButton: false
                });
            }

            // Initialize the app when DOM is loaded
            initApp();
        });
    </script>
</body>

</html>
